<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  

  
  <title>HelloWorld</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="好记性不如烂笔头，保存在收藏夹里的链接，过段时间后就可能打不开了，摘录是不错的保存方式。">
<meta property="og:type" content="website">
<meta property="og:title" content="HelloWorld">
<meta property="og:url" content="https://hefengbao.github.io/helloworld/page/14/index.html">
<meta property="og:site_name" content="HelloWorld">
<meta property="og:description" content="好记性不如烂笔头，保存在收藏夹里的链接，过段时间后就可能打不开了，摘录是不错的保存方式。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="He Fengbao">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/helloworld/atom.xml" title="HelloWorld" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/helloworld/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/helloworld/" id="logo">HelloWorld</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/helloworld/">Home</a>
        
          <a class="main-nav-link" href="/helloworld/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/helloworld/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://hefengbao.github.io/helloworld"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-phpmyadmin-Access-denied-for-user-root-localhost" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/phpmyadmin-1698-access-denied-for-user-root-localhost.html" class="article-date">
  <time datetime="2019-06-16T11:15:56.000Z" itemprop="datePublished">2019-06-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/Database/">Database</a>►<a class="article-category-link" href="/helloworld/categories/Database/MySQL/">MySQL</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/phpmyadmin-1698-access-denied-for-user-root-localhost.html">phpmyadmin</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>sudo mysql</code> 可直接登入 mysql.</p>
<p><del>Ubuntu 系统，通过命令 <code>sudo apt install mysql-server</code> 安装了 mysql, 在 Bash 界面可以免密码登录，原因是 <code>root</code> 密码为空，修改 <code>root</code> 密码，网上找到的方法：</del></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE mysql.user SET authentication_string &#x3D; PASSWORD(&#39;123456&#39;), password_expired &#x3D; &#39;N&#39; WHERE User &#x3D; &#39;root&#39; AND Host &#x3D; &#39;localhost&#39;;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>



<p><del>但是，任然可以免密码登录：</del></p>
<img src="/helloworld/images/2019061601.png" class="">

<p>配置了 phpmyadmin, 登录则出现的错误是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#1698 - Access denied for user &#39;root&#39;@&#39;localhost&#39;</span><br></pre></td></tr></table></figure>

<p>继续搜， 看到这个 <a target="_blank" rel="noopener" href="https://blog.csdn.net/david_sheep/article/details/82698709">https://blog.csdn.net/david_sheep/article/details/82698709</a>，自己试了下，果真如此</p>
<img src="/helloworld/images/2019061602.png" class="">

<p>按如下修改密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE mysql.user SET authentication_string &#x3D; PASSWORD(&#39;123456&#39;), password_expired &#x3D; &#39;N&#39;, plugin &#x3D; &#39;mysql_native_password&#39; WHERE User &#x3D; &#39;root&#39; AND Host &#x3D; &#39;localhost&#39;;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/phpmyadmin-1698-access-denied-for-user-root-localhost.html" data-id="ckweu3exv008la1vh94deez6m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Coroutines-On-Android-part-III-Real-work" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/coroutines-on-android-part3-real-work.html" class="article-date">
  <time datetime="2019-05-26T01:41:46.000Z" itemprop="datePublished">2019-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/coroutines-on-android-part3-real-work.html">Coroutines On Android (part III): Real work</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Solving-real-world-problems-with-coroutines"><a href="#Solving-real-world-problems-with-coroutines" class="headerlink" title="Solving real-world problems with coroutines"></a>Solving real-world problems with coroutines</h3><p>Part one and two of this series focused on how coroutines can be used to simplify code, provide main-safety on Android, and avoid leaking work. With that background, they look like a great solution to both background processing and a way to simplify callback based code on Android.</p>
<p>So far, we’ve focused on what coroutines are and how to manage them. In this post we’ll look at how to use them to accomplish some real tasks. Coroutines are a general purpose programming language feature at the same level as functions — so you can use them to implement anything that you could with functions and objects. However, there’s a two types of tasks that come up all the time in real code that coroutines are a great solution for:</p>
<ol>
<li><strong>One shot</strong> <strong>requests</strong> are requests that are run each time they are called — they always complete after the result is ready.</li>
<li><strong>Streaming</strong> <strong>requests</strong> are requests that continue to observe changes and report them to caller — they don’t complete when the first result is ready.</li>
</ol>
<p>Coroutines are a great solution to both of these tasks. In this post, we’ll look deeply into one shot requests and explore how to implement them using coroutines on Android.</p>
<h3 id="One-shot-requests"><a href="#One-shot-requests" class="headerlink" title="One shot requests"></a>One shot requests</h3><p>A one shot request is performed once each time it’s called and completes as soon as a result is ready. This pattern is the same as a regular function call — it gets called, does some work, then returns. Due to the similarity to function calls they tend to be easier to understand than streaming requests.</p>
<blockquote>
<p>A one shot request is performed each time it’s called. It stops executing as soon as a result is ready.</p>
</blockquote>
<p>For an example of a one shot request, consider how your browser loaded this page. When you clicked the link to this post your browser sent a network request to the server to load the page. Once the page was transferred to your browser it stopped talking to the backend — it had all the data it needed. If the server modified the post, the new changes would not be shown in your browser — you would have to refresh the page.</p>
<p>So, while they lack the live-push of streaming requests, one shot requests are pretty powerful. There’s a whole lot of things you can do in an Android app that can be solved by one shot requests like fetching, storing, or updating data. It’s also a good pattern for things like sorting a list.</p>
<h3 id="Problem-Displaying-a-sorted-a-list"><a href="#Problem-Displaying-a-sorted-a-list" class="headerlink" title="Problem: Displaying a sorted a list"></a>Problem: Displaying a sorted a list</h3><p>Let’s explore one-shot requests by looking at how you might display a sorted list. To make the example concrete, let’s build an inventory app for use by an employee at a store. It will be used to lookup products based on when they were last stocked — they’ll want to be able to sort the list both ascending and descending. It has so many products that sorting it may take almost a second — so we’ll use coroutines to avoid blocking the main thread!</p>
<p>In this app all of the products are stored in a Room database. This is a good use case to explore since it doesn’t need to involve a network request so we can focus on the pattern. Even though the example is simpler because it doesn’t use the network, it exposes the patterns needed to implement one shot requests.</p>
<p>To implement this request using coroutines, you will introduce coroutines to the <code>ViewModel</code>, <code>Repository</code>, and <code>Dao</code>. Lets walk through each one at a time and see how to integrate them with coroutines.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductsViewModel</span></span>(<span class="keyword">val</span> productsRepository: ProductsRepository): ViewModel() &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">val</span> _sortedProducts = MutableLiveData&lt;List&lt;ProductListing&gt;&gt;()</span><br><span class="line">   <span class="keyword">val</span> sortedProducts: LiveData&lt;List&lt;ProductListing&gt;&gt; = _sortedProducts</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Called by the UI when the user clicks the appropriate sort button</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">fun</span> <span class="title">onSortAscending</span><span class="params">()</span></span> = sortPricesBy(ascending = <span class="literal">true</span>)</span><br><span class="line">   <span class="function"><span class="keyword">fun</span> <span class="title">onSortDescending</span><span class="params">()</span></span> = sortPricesBy(ascending = <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">sortPricesBy</span><span class="params">(ascending: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">       viewModelScope.launch &#123;</span><br><span class="line">           <span class="comment">// suspend and resume make this database request main-safe</span></span><br><span class="line">           <span class="comment">// so our ViewModel doesn&#x27;t need to worry about threading</span></span><br><span class="line">           _sortedProducts.value =</span><br><span class="line">                   productsRepository.loadSortedProducts(ascending)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>ProductsViewModel</code> is responsible for receiving events from the UI layer, then asking the repository for the updated data. It uses <code>LiveData</code> to hold the currently sorted list to for display by the UI. When a new event comes in <code>sortProductsBy</code> starts a new coroutine to sort the list and updates the <code>LiveData</code> when the result is ready. The <code>ViewModel</code> is typically the right place to start most coroutines in this architecture, since it can cancel the coroutine in <code>onCleared</code>. If the user leaves the screen they usually have no use for outstanding work.</p>
<p><em>If you haven’t used LiveData much, check out this great post by</em> <a target="_blank" rel="noopener" href="https://twitter.com/CeruleanOtter"><em>@CeruleanOtter</em></a><em>introducing how they work to store data for UIs.</em></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/androiddevelopers/viewmodels-a-simple-example-ed5ac416317e"><strong>ViewModels : A Simple Example</strong><br><em>Introduction</em>medium.com</a></p>
<p>This is a general pattern for coroutines on Android. Since the Android framework doesn’t call suspend functions, you’ll need to coordinate with a coroutine in response to a UI event. The easiest way to do that is to just start a new coroutine when the event comes in — and the natural place to do that is in the <code>ViewModel</code>.</p>
<blockquote>
<p>As a general pattern, start coroutines in the ViewModel.</p>
</blockquote>
<p>The <code>ViewModel</code> uses a <code>ProductsRepository</code> to actually fetch the data. Here’s what that looks like:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductsRepository</span></span>(<span class="keyword">val</span> productsDao: ProductsDao) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * This is a &quot;regular&quot; suspending function, which means the caller must</span></span><br><span class="line"><span class="comment">    * be in a coroutine. The repository is not responsible for starting or </span></span><br><span class="line"><span class="comment">    * stopping coroutines since it doesn&#x27;t have a natural lifecycle to cancel</span></span><br><span class="line"><span class="comment">    * unnecessary work.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * This *may* be called from Dispatchers.Main and is main-safe because</span></span><br><span class="line"><span class="comment">    * Room will take care of main-safety for us.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadSortedProducts</span><span class="params">(ascending: <span class="type">Boolean</span>)</span></span>: List&lt;ProductListing&gt; &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">if</span> (ascending) &#123;</span><br><span class="line">           productsDao.loadProductsByDateStockedAscending()</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           productsDao.loadProductsByDateStockedDescending()</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>ProductsRepository</code> provides a reasonable interface for interacting with products. In this app, since everything is in the local Room database, it just provides a nice interface for the <code>@Dao</code> that has two different functions for the different sort orders.</p>
<p>The repository is an optional part of the Android Architecture Components architecture — but if you do have it or a similar layer in your app, it should prefer to expose regular suspend functions. Since a repository doesn’t have a natural lifecycle — it’s just an object — it would have no way to cleanup work. As a result, any coroutines started in the repository will leak by default.</p>
<p>In addition to avoiding leaks, by exposing regular suspend functions, it’s easy to re-use the repository in different contexts. Anything that knows how to make a coroutine can call <code>loadSortedProducts</code>. For example, a background job scheduled by the WorkManager library could call this directly.</p>
<blockquote>
<p>A repository should prefer to expose regular suspend functions that are main-safe.</p>
</blockquote>
<blockquote>
<p>Note: <em>Some background save operations may want to continue after user leaves a screen — and it makes sense to have those saves run without a lifecycle. In most other cases the</em> <code>*viewModelScope*</code> <em>is a reasonable choice.</em></p>
</blockquote>
<p>Moving on to <code>ProductsDao</code>, it looks like this:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ProductsDao</span> </span>&#123;</span><br><span class="line">   <span class="comment">// Because this is marked suspend, Room will use it&#x27;s own dispatcher</span></span><br><span class="line">   <span class="comment">//  to run this query in a main-safe way.</span></span><br><span class="line">   <span class="meta">@Query(<span class="meta-string">&quot;select * from ProductListing ORDER BY dateStocked ASC&quot;</span>)</span></span><br><span class="line">   <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadProductsByDateStockedAscending</span><span class="params">()</span></span>: List&lt;ProductListing&gt;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Because this is marked suspend, Room will use it&#x27;s own dispatcher</span></span><br><span class="line">   <span class="comment">//  to run this query in a main-safe way.</span></span><br><span class="line">   <span class="meta">@Query(<span class="meta-string">&quot;select * from ProductListing ORDER BY dateStocked DESC&quot;</span>)</span></span><br><span class="line">   <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadProductsByDateStockedDescending</span><span class="params">()</span></span>: List&lt;ProductListing&gt;</span><br><span class="line">&#125;        </span><br></pre></td></tr></table></figure>



<p><code>ProductsDao</code> is a Room <code>@Dao</code> that exposes two suspend functions. Because the functions are marked suspend, Room ensures they are main-safe. That means you can call them directly from <code>Dispatchers.Main</code>.</p>
<p><em>If you haven’t seen coroutines in Room yet, check out this great post by</em> <a target="_blank" rel="noopener" href="https://twitter.com/FMuntenescu">*@*FMuntenescu</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/androiddevelopers/room-coroutines-422b786dc4c5"><strong>Room 🔗 Coroutines</strong><br><em>Add some suspense to your database</em>medium.com</a></p>
<p>A bit of warning though, the coroutine that calls this will be on the main thread. So if you did something expensive with the results — like transforming them to a new list — you should make sure you’re not blocking the main thread.</p>
<blockquote>
<p><em>Note:</em> <em>Room uses its own dispatcher to run queries on a background thread. Your code</em> should not <em>use</em> <code>*withContext(Dispatchers.IO)*</code> <em>to call suspending room queries. It will complicate the code and make your queries run slower.</em></p>
</blockquote>
<blockquote>
<p>Suspend functions in Room are main-safe and run on a custom dispatcher.</p>
</blockquote>
<h3 id="The-one-shot-request-pattern"><a href="#The-one-shot-request-pattern" class="headerlink" title="The one shot request pattern"></a>The one shot request pattern</h3><p>That’s the complete pattern for making a one shot request using coroutines in Android Architecture Components. We added coroutines to the <code>ViewModel</code>, <code>Repository</code>, and <code>Room</code> and each layer has a different responsibility.</p>
<ol>
<li>ViewModel launches a coroutine on the main thread — it completes when it has a result.</li>
<li>Repository exposes regular suspend functions and ensures they are main-safe.</li>
<li>The database and network expose regular suspend functions and ensures they are main-safe.</li>
</ol>
<p><strong>The</strong> <code>**ViewModel**</code> is responsible for starting coroutines and ensuring that they get cancelled if the user leaves the screen. It doesn’t do expensive things— instead relying on other layers to do the heavy work. Once it has the result it sends it to the UI using <code>LiveData</code>.</p>
<p>Since the <code>ViewModel</code> doesn’t do heavy work it starts the coroutine on on the main thread. By starting on main it can respond to user events faster if the result is available immediately (e.g. from an in-memory cache).</p>
<p><strong>The</strong> <code>**Repository**</code> exposes regular suspend functions to access data. It typically doesn’t start it’s own long lived coroutines since it doesn’t have any way to cancel them. Whenever the <code>Repository</code> has to do expensive things like transform a list it should use <code>withContext</code> to expose a main-safe interface.</p>
<p><strong>The data layer</strong> (network or database) always exposes regular suspend functions. It is important that these suspend functions are main-safe when using Kotlin coroutines, and both Room and Retrofit follow this pattern.</p>
<p>In a one shot request, the data layer <em>only</em> exposes suspend functions. A caller has to call them again if they want a new value. This is just like the refresh button on your web browser.</p>
<p>It’s worth taking a moment to make sure you understand these patterns for one shot requests. It’s the normal pattern for coroutines on Android, and you’ll use it all of the time.</p>
<h3 id="Our-first-bug-report"><a href="#Our-first-bug-report" class="headerlink" title="Our first bug report!"></a>Our first bug report!</h3><p>After testing that solution, you launch it to production and everything is going well for weeks until you get a really strange bug report:</p>
<blockquote>
<p><strong>Subject:</strong> 🐞 — wrong sort order!</p>
</blockquote>
<blockquote>
<p><strong>Report:</strong> When I click the sort order buttons really really really really quickly, sometimes the sort is wrong. This doesn’t happen all the time 🙃.</p>
</blockquote>
<p>You take a look and scratch your head. What could possibly go wrong? The algorithm seems fairly simple:</p>
<ol>
<li>Start the sort the user requested.</li>
<li>Run the sort in the Room dispatcher.</li>
<li>Show the result of the sort.</li>
</ol>
<p>You’re tempted to close the bug <strong>“wontfix — don’t press the buttons so fast”</strong>but you’re worried something may be broken. After adding logging statements and writing a test to call lots of sorts at once— you finally figure it out!</p>
<p>It turns out the result shown isn’t actually the “result of <em>the</em> sort,” it’s actually the result of the “<em>last sort</em> to complete.” When the user spams the button — they start multiple sorts at the same time and they can finish in any order!</p>
<blockquote>
<p>When starting a new coroutine in response to a UI event, consider what happens if the user starts another before this one completes.</p>
</blockquote>
<p>This is a <em>concurrency bug</em> and it doesn’t really have anything to do with coroutines. We’d have the same bug if we used callbacks, Rx, or even an <code>ExecutorService</code> the same way.</p>
<p>There are many many ways to fix this in both the <code>ViewModel</code> and the <code>Repository</code>. Let’s explore some patterns for ensuring that one shot requests complete in the order the user expects.</p>
<h3 id="The-best-solution-Disable-the-button"><a href="#The-best-solution-Disable-the-button" class="headerlink" title="The best solution: Disable the button"></a>The best solution: Disable the button</h3><p>The fundamental problem is that we’re doing two sorts. We can fix that by making it only do one sort! The easiest way to do that is to disable the sort buttons to stop the new events.</p>
<p>This may seem like a simple solution, but it’s a really good idea. The code to implement this is simple, easy to test, and as long as it makes sense in the UI it’ll completely fix the problem!</p>
<p>To disable the buttons, tell the UI that a sort request is happening inside of <code>sortPricesBy</code> like this:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Solution 0: Disable the sort buttons when any sort is running</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductsViewModel</span></span>(<span class="keyword">val</span> productsRepository: ProductsRepository): ViewModel() &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">val</span> _sortedProducts = MutableLiveData&lt;List&lt;ProductListing&gt;&gt;()</span><br><span class="line">   <span class="keyword">val</span> sortedProducts: LiveData&lt;List&lt;ProductListing&gt;&gt; = _sortedProducts</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">val</span> _sortButtonsEnabled = MutableLiveData&lt;<span class="built_in">Boolean</span>&gt;()</span><br><span class="line">   <span class="keyword">val</span> sortButtonsEnabled: LiveData&lt;<span class="built_in">Boolean</span>&gt; = _sortButtonsEnabled</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">init</span> &#123;</span><br><span class="line">       _sortButtonsEnabled.value = <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Called by the UI when the user clicks the appropriate sort button</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">fun</span> <span class="title">onSortAscending</span><span class="params">()</span></span> = sortPricesBy(ascending = <span class="literal">true</span>)</span><br><span class="line">   <span class="function"><span class="keyword">fun</span> <span class="title">onSortDescending</span><span class="params">()</span></span> = sortPricesBy(ascending = <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">sortPricesBy</span><span class="params">(ascending: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">       viewModelScope.launch &#123;</span><br><span class="line">           <span class="comment">// disable the sort buttons whenever a sort is running</span></span><br><span class="line">           _sortButtonsEnabled.value = <span class="literal">false</span></span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               _sortedProducts.value =</span><br><span class="line">                       productsRepository.loadSortedProducts(ascending)</span><br><span class="line">           &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">               <span class="comment">// re-enable the sort buttons after the sort is complete</span></span><br><span class="line">               _sortButtonsEnabled.value = <span class="literal">true</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Disabling the buttons while a sort runs using _sortButtonsEnabled in sortPricesBy.</p>
<p>Ok that one was not too bad. Just disable the buttons inside of <code>sortPricesBy</code>around the call to the repository.</p>
<p>And in most cases it’s the right way to fix this problem. But what if we wanted to leave the buttons enabled and fix the bug? That’s a bit harder, and we’ll spend the rest of this post exploring a few different options.</p>
<blockquote>
<p>Important: <em>This code shows a major advantage of starting on main — the buttons disable instantly in response to a click. If you switched dispatchers, a fast-fingered user on a slow phone could send more than one click!</em></p>
</blockquote>
<h3 id="Concurrency-patterns"><a href="#Concurrency-patterns" class="headerlink" title="Concurrency patterns"></a>Concurrency patterns</h3><p>The next few sections explore advanced topics — and if you’re just starting with coroutines you don’t need to understand them right away. Simply disabling the button is the best solution to most problems you’ll run across.</p>
<p>For the rest of this post, we’ll explore ways to use coroutines to leave the button enabled but ensure that one shot requests are executed in an order that doesn’t surprise the user. We can do that by avoiding accidental concurrency by controlling when the coroutines run (or don’t run).</p>
<p>There are three basic patterns that you can use for a one shot request to ensure that exactly one request runs at a time.</p>
<ol>
<li><strong>Cancel previous work</strong> before starting more.</li>
<li><strong>Queue the next work</strong> and wait for the previous requests to complete before starting another one.</li>
<li><strong>Join previous work</strong> if there’s already a request running just return that one instead of starting another request.</li>
</ol>
<p>As you look through these solutions you’ll notice that they have some complexity to their implementations. To focus in on how to use these patterns instead of implementation details I’ve <a target="_blank" rel="noopener" href="https://gist.github.com/objcode/7ab4e7b1df8acd88696cb0ccecad16f7#file-concurrencyhelpers-kt-L19">created a gist with implementations of all three patterns</a> as reusable abstractions.</p>
<h4 id="Solution-1-Cancel-the-previous-work"><a href="#Solution-1-Cancel-the-previous-work" class="headerlink" title="Solution #1: Cancel the previous work"></a>Solution #1: Cancel the previous work</h4><p>In the case of sorting, getting a new event from the user often means you can cancel the last sort. After all, what’s the point of continuing if the user has already told you they don’t want the result?</p>
<p>To cancel the previous request, we’ll need to keep track of it somehow. The function <code>cancelPreviousThenRun</code> <a target="_blank" rel="noopener" href="https://gist.github.com/objcode/7ab4e7b1df8acd88696cb0ccecad16f7#file-concurrencyhelpers-kt-L91">in the gist</a> does exactly that.</p>
<p>Lets take a look at how it can be used to fix the bug:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Solution #1: Cancel previous work</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This is a great solution for tasks like sorting and filtering that</span></span><br><span class="line"><span class="comment">// can be cancelled if a new request comes in.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductsRepository</span></span>(<span class="keyword">val</span> productsDao: ProductsDao, <span class="keyword">val</span> productsApi: ProductsService) &#123;</span><br><span class="line">   <span class="keyword">var</span> controlledRunner = ControlledRunner&lt;List&lt;ProductListing&gt;&gt;()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadSortedProducts</span><span class="params">(ascending: <span class="type">Boolean</span>)</span></span>: List&lt;ProductListing&gt; &#123;</span><br><span class="line">       <span class="comment">// cancel the previous sorts before starting a new one</span></span><br><span class="line">       <span class="keyword">return</span> controlledRunner.cancelPreviousThenRun &#123;</span><br><span class="line">           <span class="keyword">if</span> (ascending) &#123;</span><br><span class="line">               productsDao.loadProductsByDateStockedAscending()</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               productsDao.loadProductsByDateStockedDescending()</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Using cancelPreviousThenRun to ensure that only one sort runs at a time.</p>
<p>Looking at the <a target="_blank" rel="noopener" href="https://gist.github.com/objcode/7ab4e7b1df8acd88696cb0ccecad16f7#file-concurrencyhelpers-kt-L91">example implementation</a> for <code>cancelPreviousThenRun</code> in the gist is a good way to see how to keep track of in-progress work.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// see the complete implementation at</span></span><br><span class="line"><span class="comment">// https://gist.github.com/objcode/7ab4e7b1df8acd88696cb0ccecad16f7</span></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">cancelPreviousThenRun</span><span class="params">(block: <span class="type">suspend</span> () -&gt; <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">   <span class="comment">// If there is an activeTask, cancel it because it&#x27;s result is no longer needed</span></span><br><span class="line">   activeTask?.cancelAndJoin()</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>In a nutshell it always keeps track of the currently active sort in the member variable <code>activeTask</code>. Whenever a sort starts, it will immediately <code>cancelAndJoin</code> on whatever is currently in <code>activeTask</code>. This has the effect of cancelling any in progress sorts before starting a new one.</p>
<p>It’s a good idea to use abstractions similar to <code>ControlledRunner&lt;T&gt;</code> to encapsulate logic like this it instead of mixing ad-hoc concurrency with application logic.</p>
<blockquote>
<p>Consider building abstractions to avoid mixing ad-hoc concurrency patterns with application code.</p>
</blockquote>
<blockquote>
<p>Important: <em>This pattern is not well suited for use in global singletons, since unrelated callers shouldn’t cancel each other.</em></p>
</blockquote>
<h4 id="Solution-2-Queue-the-next-work"><a href="#Solution-2-Queue-the-next-work" class="headerlink" title="Solution #2: Queue the next work"></a>Solution #2: Queue the next work</h4><p>There’s one solution to concurrency bugs that <em>always works.</em></p>
<p>Just queue up requests so only one thing can happen at a time! Just like a queue or a line at a store, requests will execute one at a time in the order they started.</p>
<p>For this particular problem of sorting, cancelling is probably better than queuing, but it’s worth talking about because it <em>always works</em>.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Solution #2: Add a Mutex</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Note: This is not optimal for the specific use case of sorting</span></span><br><span class="line"><span class="comment">// or filtering but is a good pattern for network saves.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductsRepository</span></span>(<span class="keyword">val</span> productsDao: ProductsDao, <span class="keyword">val</span> productsApi: ProductsService) &#123;</span><br><span class="line">   <span class="keyword">val</span> singleRunner = SingleRunner()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadSortedProducts</span><span class="params">(ascending: <span class="type">Boolean</span>)</span></span>: List&lt;ProductListing&gt; &#123;</span><br><span class="line">       <span class="comment">// wait for the previous sort to complete before starting a new one</span></span><br><span class="line">       <span class="keyword">return</span> singleRunner.afterPrevious &#123;</span><br><span class="line">           <span class="keyword">if</span> (ascending) &#123;</span><br><span class="line">               productsDao.loadProductsByDateStockedAscending()</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               productsDao.loadProductsByDateStockedDescending()</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Whenever a new sort comes in, it uses a instance of <code>SingleRunner</code> to ensure that only one sort is running at a time.</p>
<p>It <a target="_blank" rel="noopener" href="https://gist.github.com/objcode/7ab4e7b1df8acd88696cb0ccecad16f7#file-concurrencyhelpers-kt-L49">uses a </a><code>Mutex</code>, which is a single ticket (or lock), that a coroutine must get in order to enter the block. If another coroutine tried while one was running, it would suspend itself until all pending coroutines were done with the <code>Mutex</code>.</p>
<blockquote>
<p>A Mutex lets you ensure only one coroutine runs at a time — and they will finish in the order they started.</p>
</blockquote>
<h4 id="Solution-3-Join-previous-work"><a href="#Solution-3-Join-previous-work" class="headerlink" title="Solution 3: Join previous work"></a>Solution 3: Join previous work</h4><p>The third solution to consider is joining the previous work. It’s a good idea if the new request would re-start the exact same work that has already been half completed.</p>
<p>This pattern doesn’t make very much sense with the sort function, but it’s a natural fit for a network fetch that loads data.</p>
<p>For our product inventory app, the user will need a way to fetch a new product inventory from the server. As a simple UI, we’ll provide them with a refresh button that they can press to start a new network request.</p>
<p>Just like the sort buttons, simply disabling the button while the request is running is a complete solution to the problem. But if we didn’t — or couldn’t — do that, we could instead join the existing request.</p>
<p>Lets look at some code using <a target="_blank" rel="noopener" href="https://gist.github.com/objcode/7ab4e7b1df8acd88696cb0ccecad16f7#file-concurrencyhelpers-kt-L124">joinPreviousOrRun</a> from the gist for an example of how this might work:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductsRepository</span></span>(<span class="keyword">val</span> productsDao: ProductsDao, <span class="keyword">val</span> productsApi: ProductsService) &#123;</span><br><span class="line">   <span class="keyword">var</span> controlledRunner = ControlledRunner&lt;List&lt;ProductListing&gt;&gt;()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">fetchProductsFromBackend</span><span class="params">()</span></span>: List&lt;ProductListing&gt; &#123;</span><br><span class="line">       <span class="comment">// if there&#x27;s already a request running, return the result from the </span></span><br><span class="line">       <span class="comment">// existing request. If not, start a new request by running the block.</span></span><br><span class="line">       <span class="keyword">return</span> controlledRunner.joinPreviousOrRun &#123;</span><br><span class="line">           <span class="keyword">val</span> result = productsApi.getProducts()</span><br><span class="line">           productsDao.insertAll(result)</span><br><span class="line">           result</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>This inverts the behavior of <code>cancelPreviousAndRun</code>. Instead of discarding the previous request by cancelling it — it will discard the new request and avoid running it. If there’s already a request running, it waits for the result of current “in flight” request and returns that instead of running a new one. The block will only be executed if there was not already a request running.</p>
<p>You can see how this works at the start of <code>joinPreviousOrRun</code> — it just returns the previous result if there’s anything in <code>activeTask</code>:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// see the complete implementation at</span></span><br><span class="line"><span class="comment">// https://gist.github.com/objcode/7ab4e7b1df8acd88696cb0ccecad16f7#file-concurrencyhelpers-kt-L124</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">joinPreviousOrRun</span><span class="params">(block: <span class="type">suspend</span> () -&gt; <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">    <span class="comment">// if there is an activeTask, return it&#x27;s result and don&#x27;t run the block</span></span><br><span class="line">    activeTask?.let &#123;</span><br><span class="line">        <span class="keyword">return</span> it.await()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>



<p>This pattern scales well for requests like fetching products by <code>id</code>. You could add add a map from <code>id</code> to <code>Deferred</code> then use the same join logic to keep track of previous requests for the same product.</p>
<blockquote>
<p>Join previous work is a great solution to avoiding repeated network requests.</p>
</blockquote>
<h3 id="What’s-next"><a href="#What’s-next" class="headerlink" title="What’s next?"></a>What’s next?</h3><p>In this post we explored how to implement a one shot request using Kotlin coroutines. To start out we implemented a complete pattern showing how to start a coroutine in the <code>ViewModel</code> and then expose regular suspend functions from a <code>Repository</code> and Room <code>Dao</code>.</p>
<p>For most tasks, this is all you need to do in order to use Kotlin coroutines on Android. This pattern can be applied to many common tasks like sorting a list like we showed here. You can also use it to fetch, save, or update data on the network</p>
<p>We then looked at a subtle bug that can come up and possible solutions. The easiest (and often best) way to fix this is in the UI — just disable the sort buttons while a sort is in progress.</p>
<p>And wrapping up we looked at some advanced concurrency patterns and how to implement them in Kotlin coroutines. The <a target="_blank" rel="noopener" href="https://gist.github.com/objcode/7ab4e7b1df8acd88696cb0ccecad16f7#file-concurrencyhelpers-kt-L158">code for this</a> is a bit complex, but it does provide a good introduction to some advanced coroutines topics.</p>
<p>In the next post, we’ll take a look at streaming requests and explore how to use the <code>liveData</code> builder!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/coroutines-on-android-part3-real-work.html" data-id="ckweu3ext008ea1vhca2ygf4d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/android/" rel="tag">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/kotlin/" rel="tag">kotlin</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-store-use-sensitive-information-in-android-development" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/how-to-store-use-sensitive-information-in-android-development.html" class="article-date">
  <time datetime="2019-05-26T01:23:01.000Z" itemprop="datePublished">2019-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/how-to-store-use-sensitive-information-in-android-development.html">How To Store Use Sensitive Information In Android Development</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Step-1-Consolidate-sensitive-information-in-file-s-and-ignore-from-the-repo"><a href="#Step-1-Consolidate-sensitive-information-in-file-s-and-ignore-from-the-repo" class="headerlink" title="Step 1 : Consolidate sensitive information in file(s) and ignore from the repo"></a>Step 1 : Consolidate sensitive information in file(s) and ignore from the repo</h3><p>The first naive thought is just to write all the sensitive information in a file and don’t commit it. List the file in .<strong>gitignore</strong> so that nobody accidentally commits it.</p>
<p>For example, we can store all API keys/secrets in <strong>app/keys.properties:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TMDB_API_KEY&#x3D;XXXXYYYYZZZZ</span><br><span class="line">AZURE_API_KEY&#x3D;AAAABBBBCCCC</span><br><span class="line">AWS_API_KEY&#x3D;LLLLMMMMNNNNN</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>.gitignore</strong> would look like this.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"># Files with sensitive info</span><br><span class="line">app&#x2F;keys.properties</span><br></pre></td></tr></table></figure>

<p>Now, how can we use the <code>TMDB_API_KEY</code> from the main Java/Kotlin code? We can let gradle to generate some code for you.</p>
<p>In your <strong>app/build.gradle</strong>, you can write something like this.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            ...</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;TMDB_API_KEY&quot;, &quot;\&quot;&quot; + getTmdbApiKey() + &quot;\&quot;&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        debug &#123;</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;TMDB_API_KEY&quot;, &quot;\&quot;&quot; + getTmdbApiKey() + &quot;\&quot;&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">def getTmdbApiKey() &#123;</span><br><span class="line">    def keysFile &#x3D; file(&quot;keys.properties&quot;)</span><br><span class="line">    def keysProperties &#x3D; new Properties()</span><br><span class="line">    keysProperties.load(new FileInputStream(keysFile))</span><br><span class="line">    def tmdbApiKey &#x3D; keysProperties[&#39;TMDB_API_KEY&#39;]</span><br><span class="line">    return tmdbApiKey</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Basically, you read the sensitive file and get the key value pairs, feed the corresponding API key value you want into the magic function <code>**buildConfigField**</code>. This function is going to create a static field with provided parameters after gradle sync. The auto generated<code>**BuildConfig.java**</code> will look like this.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public final class BuildConfig &#123;</span><br><span class="line">  ...</span><br><span class="line">  public static final String TMDB_API_KEY &#x3D; &quot;XXXXYYYYZZZZ&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now you can access this global variable from anywhere in the app. If you are using Retrofit to generate API client code, you can do something like this.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface TMDBService &#123;</span><br><span class="line">    @GET(&quot;3&#x2F;movie&#x2F;now_playing&quot;)</span><br><span class="line">    fun nowplaying(@Query(&quot;page&quot;) page: Int,</span><br><span class="line">                   @Query(&quot;api_key&quot;) apiKey: String &#x3D; BuildConfig.TMDB_API_KEY</span><br><span class="line">    ): Flowable&lt;MoviesPage&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, this is awesome. Your sensitive information is consolidated in a single place (keys.properties in this example) and is not going to be easily pushed to any repository by accident. You can pass the file to a new team mate as he/she joins. Your team can probably manage the file in 1Password or a dedicated private repository.</p>
<blockquote>
<p>NOTE: Obviously, it is cumbersome and has drawbacks to pass keys.properties to the new team members outside of repository. I will explain the solution in the Step 3.</p>
</blockquote>
<h3 id="Step-2-Make-CI-CD-work-with-environment-variable"><a href="#Step-2-Make-CI-CD-work-with-environment-variable" class="headerlink" title="Step 2: Make CI/CD work with environment variable"></a>Step 2: Make CI/CD work with environment variable</h3><p>With the previous step, we successfully skipped sensitive information to be included in the repository. However, that will cause a problem to the CI/CD system. Remember the <code>build.gradle</code> we wrote above.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            ...</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;TMDB_API_KEY&quot;, &quot;\&quot;&quot; + getTmdbApiKey() + &quot;\&quot;&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        debug &#123;</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;TMDB_API_KEY&quot;, &quot;\&quot;&quot; + getTmdbApiKey() + &quot;\&quot;&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">def getTmdbApiKey() &#123;</span><br><span class="line">    def keysFile &#x3D; file(&quot;keys.properties&quot;)</span><br><span class="line">    def keysProperties &#x3D; new Properties()</span><br><span class="line">    keysProperties.load(new FileInputStream(keysFile))</span><br><span class="line">    def tmdbApiKey &#x3D; keysProperties[&#39;TMDB_API_KEY&#39;]</span><br><span class="line">    return tmdbApiKey</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The gradle sync on CI/CD server would fail because it cannot find <code>keys.properties</code>, because it was omitted from the repository.</p>
<p>You might have guessed : here comes good old environment variables. Every CI/CD system has an entry for environment variables. This screen is from Circle CI for example.</p>
<img src="/helloworld/images/2019052601.png" class="">

<p>Environment Variables Screen for Circle CI</p>
<p>You can just “Add Variable” for<code>TMDB_API_KEY</code> in this case.</p>
<p>And of course, we have to modify our gradle script to look at environment variables in addition to the file(s).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def getTmdbApiKey() &#123;</span><br><span class="line">    def tmdbApiKey &#x3D; System.getenv(&quot;TMDB_API_KEY&quot;)</span><br><span class="line">    if (tmdbApiKey &#x3D;&#x3D; null || tmdbApiKey.length() &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        def keysFile &#x3D; file(&quot;keys.properties&quot;)</span><br><span class="line">        def keysProperties &#x3D; new Properties()        keysProperties.load(new FileInputStream(keysFile))</span><br><span class="line">        tmdbApiKey &#x3D; keysProperties[&#39;TMDB_API_KEY&#39;]</span><br><span class="line">        if (tmdbApiKey &#x3D;&#x3D; null) &#123;</span><br><span class="line">            logger.error(&quot;You need to either place appropriate keys.properties or set proper environment variables for API key&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return tmdbApiKey</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, in the modified function above, we first look at the environment variable <strong>TMDB_API_KEY</strong>. If the environment variable is not defined, we will read from the file as before. As long as CI/CD has that environment variable properly set, it can successfully generate a build.</p>
<h3 id="Step-3-Encrypt-the-sensitive-keys-and-push-to-the-repository"><a href="#Step-3-Encrypt-the-sensitive-keys-and-push-to-the-repository" class="headerlink" title="Step 3 : Encrypt the sensitive keys and push to the repository"></a>Step 3 : Encrypt the sensitive keys and push to the repository</h3><p>By consolidating sensitive key information in file(s) and configuring gradle scripts properly, you can set up your Android project to hide sensitive information from the repository.</p>
<p>With this approach, however, we have to have another storage to just store the sensitive information. If we use some password manager (e.g., 1Password), then you cannot manage versions of the sensitive file. You can work this around by setting up a dedicated private repository, but it’s a bit cumbersome that you have to pull/copy the file from a separate repository.</p>
<p>Here comes <a target="_blank" rel="noopener" href="https://git-secret.io/">git-secret</a>. It uses GPG under the hood and allows easy interface for the repository manager to encrypt secret files so that only certain developers are allowed to decrypt those.</p>
<h4 id="Initial-Setup"><a href="#Initial-Setup" class="headerlink" title="Initial Setup"></a>Initial Setup</h4><p>The repository manager needs to put the repository under control of <code>git-secret</code> and specify file(s) to encrypt. This only needs to happen once. Following commands should be executed from the top level directory of the repository.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% git secret init                    &#x2F;&#x2F; You only need to do this once</span><br><span class="line">% git secret add app&#x2F;keys.properties &#x2F;&#x2F; You only need to do this once per file</span><br></pre></td></tr></table></figure>

<h4 id="Developer-passes-the-public-key-to-the-repository-manager"><a href="#Developer-passes-the-public-key-to-the-repository-manager" class="headerlink" title="Developer passes the public key to the repository manager"></a>Developer passes the public key to the repository manager</h4><p>The repository manager needs to obtain GPG public key from individual developers. Individual developer can follow <a target="_blank" rel="noopener" href="https://help.github.com/en/articles/generating-a-new-gpg-key">this link</a> to create and export GPG public key. One important thing for the developer is that he/she <strong>SHOULD NEVER FORGET THE PASSPHRASE HE/SHE SET HERE.</strong> It’s quite cumbersome to recover from that situation, and I bet you want to avoid facing unhappy devops or a tech lead.</p>
<h4 id="Repository-manager-encrypts-secret-file-s-using-the-public-keys"><a href="#Repository-manager-encrypts-secret-file-s-using-the-public-keys" class="headerlink" title="Repository manager encrypts secret file(s) using the public keys."></a>Repository manager encrypts secret file(s) using the public keys.</h4><p>On receiving the public key, the repository manager runs the following command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% gpg --import IMPORTED_PUBLIC_KEY.txt</span><br></pre></td></tr></table></figure>

<p>Now, repository managers machine can encrypt any file using developers’ GPG public keys. The repo manager can then type following command to grant access for the developer to the respository.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% git secret tell xxx@yyy.com</span><br></pre></td></tr></table></figure>

<p>The Email is the one associated to the imported public key. You can probably check the email via <code>**pgp --list-keys**</code> after doing the import.</p>
<p>Now, you can issue the magic command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% git secret hide</span><br></pre></td></tr></table></figure>

<p>This will create an encrypted file <strong>app/keys.properties.secret</strong> out of <strong>app/keys.properties</strong>, using the public keys registered to the machine. The repository manager can then push the encrypted file to the repository.</p>
<h4 id="Any-developer-can-decrypt-secret-file-s-with-a-simple-command"><a href="#Any-developer-can-decrypt-secret-file-s-with-a-simple-command" class="headerlink" title="Any developer can decrypt secret file(s) with a simple command."></a>Any developer can decrypt secret file(s) with a simple command.</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% git secret reveal</span><br></pre></td></tr></table></figure>

<p>The above command lets you regenerate <strong>app/keys.properties</strong> out of <strong>app/keys.properties.secret</strong> as long as the steps above have been successfully completed. 💥💥💥</p>
<p>The initial setup is a little bit involved process, but it becomes very simple after that. Every time a new developer comes in, he/she needs to send the public key to the repository manager, where he/she add the user and re-encrypt the file(s). The new member can then just pull the repository and enter <code>**git secret reveal**</code>. It is much better than searching the file in some other storage, possibly without knowing whether that is the latest version or not.</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>I have introduced the 3 steps to share sensitive information without pushing it to the repository. The 3rd step is probably optional at this point. It requires some effort of setting up, and also has some shortcomings like follows:</p>
<ul>
<li>You always need to run the <code>**git secret hide**</code> command in a machine that has everybody’s public keys.</li>
<li>When the secret file(s) is updated and pushed to the repo, developers should not forget to run <code>**git secret reveal**</code>. Otherwise, you will keep running the app based on old info.</li>
</ul>
<p>However, the above points are limitations of current toolset and hopefully will get better soon. Overall, the trend is heading to the direction to commit encrypted version of secret files in the same repository. Another tool that fills the same purpose is <a target="_blank" rel="noopener" href="https://github.com/AGWA/git-crypt">git-crypt.</a></p>
<p>First 2 steps, at this moment, is probably something we should follow in every Android project. Once CI systems offer reliable support for <code>git-secret</code> or <code>git-crypt</code>, we may just implement the decryption process on the CI and skip Step2 (getting info through environment variable)</p>
<p>来源：</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@yfujiki/how-to-store-use-sensitive-information-in-android-development-bc352892ece7">https://medium.com/@yfujiki/how-to-store-use-sensitive-information-in-android-development-bc352892ece7</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/how-to-store-use-sensitive-information-in-android-development.html" data-id="ckweu3exu008ia1vhahbkcep9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/android/" rel="tag">android</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Getting-started-using-Moshi-for-JSON-parsing-with-Kotlin" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/getting-started-using-moshi-for-json-parsing-with-kotlin.html" class="article-date">
  <time datetime="2019-05-19T02:29:18.000Z" itemprop="datePublished">2019-05-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/Kotlin/">Kotlin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/getting-started-using-moshi-for-json-parsing-with-kotlin.html">Getting started using Moshi for JSON parsing with Kotlin</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>After using Gson for parsing JSON API responses in android I started using the <a target="_blank" rel="noopener" href="https://github.com/square/moshi">Moshi</a> JSON library created by Square as it targets the android platform, supports using Kotlin language features, is lightweight (with codegen) and has a simpler API.</p>
<p>As a consumer of a restful API with JSON responses it is preferable to handle any issues at the boundary of the data layer in your model rather than have them propagate into the app and have to track them down. Kotlin’s native language features are supported with Moshi to ensure the type safety of a Kotlin class used with adapters to parse JSON responses.</p>
<p>This article demonstrates how this is achieved from setting up Moshi, using it to parse JSON into a simple model object and implementing your own adapter.</p>
<h3 id="Set-up-using-codegen"><a href="#Set-up-using-codegen" class="headerlink" title="Set-up using codegen"></a>Set-up using codegen</h3><p>Prior to version 1.6 Moshi was implemented using reflection with the kotlin-reflect artifact which at 2.5MB is quite heavyweight for an android app. Since version 1.6 you can also use codegen with the moshi-kotlin-codegen artifact. This is preferred for runtime performance and use of Kotlin language features in the generated adapters. (The only limitation compared with the reflection artifact is that it doesn’t support private and protected fields). In this article I’ll use codegen which requires this gradle configuration:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;kotlin-kapt&#x27;</span></span><br><span class="line">...</span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">&#x27;com.squareup.moshi:moshi:1.8.0&#x27;</span></span><br><span class="line">    kapt <span class="string">&#x27;com.squareup.moshi:moshi-kotlin-codegen:1.8.0&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Parsing-JSON-into-a-simple-model-object"><a href="#Parsing-JSON-into-a-simple-model-object" class="headerlink" title="Parsing JSON into a simple model object"></a>Parsing JSON into a simple model object</h3><p>Consider this JSON and Kotlin data class for a movie:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;vote_count&quot;</span>: <span class="number">2026</span>,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">19404</span>,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Example Movie&quot;</span>,</span><br><span class="line">  <span class="string">&quot;image_path&quot;</span>: <span class="string">&quot;/example-movie-image.jpg&quot;</span>,</span><br><span class="line">  <span class="string">&quot;overview&quot;</span>: <span class="string">&quot;Overview of example movie&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@JsonClass(generateAdapter = true)</span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>(</span><br><span class="line">    <span class="meta">@Json(name = <span class="meta-string">&quot;vote_count&quot;</span>)</span> <span class="keyword">val</span> voteCount: <span class="built_in">Int</span> = -<span class="number">1</span>,</span><br><span class="line">    <span class="keyword">val</span> id: <span class="built_in">Int</span>,</span><br><span class="line">    <span class="keyword">val</span> title: String,</span><br><span class="line">    <span class="meta">@Json(name = <span class="meta-string">&quot;image_path&quot;</span>)</span> <span class="keyword">val</span> imagePath: String,</span><br><span class="line">    <span class="keyword">val</span> overview: String</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>There are a couple of things to highlight here. We’ve annotated the class with<code>@JsonClass(generateAdapter = true)</code> which will generate a JsonAdapter to handle serializing/deserializing to and from JSON of the specified type.</p>
<p>The<code>@Json(name = “value”)</code> annotation defines the JSON key name for serialisation and the property to set the value on with deserialization.</p>
<blockquote>
<p>This annotation works similarly to <code>*@SerializedName(“some_json_key”)*</code> in Gson and <code>*@JsonProperty(&quot;some_json_key&quot;)*</code> in Jackson.</p>
</blockquote>
<p>To hook it all up and parse the json to the data class you need to create a Moshi object, create the adapter instance and then pass the JSON to the adapter:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> moshi: Moshi = Moshi.Builder().build()</span><br><span class="line"><span class="keyword">val</span> adapter: JsonAdapter&lt;Movie&gt; = moshi.adapter(Movie::<span class="keyword">class</span>.java)</span><br><span class="line"><span class="keyword">val</span> movie = adapter.fromJson(moviesJson))</span><br></pre></td></tr></table></figure>

<h4 id="Moshi-handling-of-null-and-absent-JSON-fields"><a href="#Moshi-handling-of-null-and-absent-JSON-fields" class="headerlink" title="Moshi handling of null and absent JSON fields"></a>Moshi handling of null and absent JSON fields</h4><p>If the JSON response changes and sets a null field in the JSON then the adapter will fail respecting the non null reference of a <code>val</code> property in the data class and throw a clear exception.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;vote_count&quot;</span>: 2026,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: 19404,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Example Movie&quot;</span>,</span><br><span class="line">  <span class="string">&quot;image_path&quot;</span>: <span class="string">&quot;/example-movie-image.jpg&quot;</span>,</span><br><span class="line">  <span class="string">&quot;overview&quot;</span>: null</span><br><span class="line">&#125;</span><br><span class="line">com.squareup.moshi.JsonDataException: Non-null value <span class="string">&#x27;overview&#x27;</span> was null at $[0].overview</span><br></pre></td></tr></table></figure>

<p>If the JSON response has an absent field then again the reason for the thrown exception is clear:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;vote_count&quot;</span>: 2026,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: 19404,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Example Movie&quot;</span>,</span><br><span class="line">  <span class="string">&quot;image_path&quot;</span>: <span class="string">&quot;/example-movie-image.jpg&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">com.squareup.moshi.JsonDataException: Required property ‘overview’ missing at $[1]</span><br></pre></td></tr></table></figure>

<p>Default properties work just as expected setting the voteCount to -1 if it is absent in the consumed JSON. If the property is nullable, however, and null is set in the the JSON then the null value takes precedence. So <code>@Json(name = &quot;vote_count&quot;) val voteCount: Int? = -1</code> will set <code>voteCount</code> to null if “<code>vote_count&quot;: null</code> is in the JSON.</p>
<h3 id="Creating-your-own-JSON-adapter"><a href="#Creating-your-own-JSON-adapter" class="headerlink" title="Creating your own JSON adapter"></a>Creating your own JSON adapter</h3><p>There will be times when you don’t want a JSON key to map directly to a Kotlin property and you can create your own custom adapter to change the parsing.</p>
<p>Take a look at the updated JSON and corresponding model where genres the movie belongs to have been introduced referenced by genre id:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;vote_count&quot;</span>: <span class="number">2026</span>,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">19404</span>,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Example Movie&quot;</span>,</span><br><span class="line">  <span class="string">&quot;genre_ids&quot;</span>: [</span><br><span class="line">    <span class="number">35</span>,</span><br><span class="line">    <span class="number">18</span>,</span><br><span class="line">    <span class="number">10749</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;overview&quot;</span>: <span class="string">&quot;Overview of example movie&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@JsonClass(generateAdapter = true)</span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Movie</span> </span>(</span><br><span class="line">    <span class="meta">@Json(name = <span class="meta-string">&quot;vote_count&quot;</span>)</span> <span class="keyword">val</span> voteCount: <span class="built_in">Int</span> = -<span class="number">1</span>,</span><br><span class="line">    <span class="keyword">val</span> id: <span class="built_in">Int</span>,</span><br><span class="line">    <span class="keyword">val</span> title: String,</span><br><span class="line">    <span class="meta">@Json(name = <span class="meta-string">&quot;genre_ids&quot;</span>)</span> <span class="keyword">val</span> genres: List&lt;Genre&gt;,</span><br><span class="line">    <span class="keyword">val</span> overview: String</span><br><span class="line">)</span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Genre</span></span>(<span class="keyword">val</span> id: <span class="built_in">Int</span>, <span class="keyword">val</span> name: String)</span><br></pre></td></tr></table></figure>

<p>As you haven’t specified how to map the ids to create a genre the parsing fails with <code>com.squareup.moshi.JsonDataException: Expected BEGIN_OBJECT but was NUMBER at path $[0].genre_ids[0]</code> From the model you can see a list of Genre is expected in the JSON but a list of NUMBER is found</p>
<p>To do this mapping you need to create your own adapter and register it when you create the moshi instance:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Movie genres from the The movie database https://www.themoviedb.org/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenreAdapter</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ToJson</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">toJson</span><span class="params">(genres: <span class="type">List</span>&lt;<span class="type">Genre</span>&gt;)</span></span>: List&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> genres.map &#123; genre -&gt; genre.id&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@FromJson</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">fromJson</span><span class="params">(genreId: <span class="type">Int</span>)</span></span>: Genre &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">when</span> (genreId) &#123;</span><br><span class="line">                <span class="number">28</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">28</span>, <span class="string">&quot;Action&quot;</span>)</span><br><span class="line">                <span class="number">12</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">12</span>, <span class="string">&quot;Adventure&quot;</span>)</span><br><span class="line">                <span class="number">16</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">16</span>, <span class="string">&quot;Animation&quot;</span>)</span><br><span class="line">                <span class="number">35</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">35</span>, <span class="string">&quot;Comedy&quot;</span>)</span><br><span class="line">                <span class="number">80</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">80</span>, <span class="string">&quot;Crime&quot;</span>)</span><br><span class="line">                <span class="number">99</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">99</span>, <span class="string">&quot;Documentary&quot;</span>)</span><br><span class="line">                <span class="number">18</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">18</span>, <span class="string">&quot;Drama&quot;</span>)</span><br><span class="line">                <span class="number">10751</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">10751</span>, <span class="string">&quot;Family&quot;</span>)</span><br><span class="line">                <span class="number">14</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">14</span>, <span class="string">&quot;Fantasy&quot;</span>)</span><br><span class="line">                <span class="number">36</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">36</span>, <span class="string">&quot;History&quot;</span>)</span><br><span class="line">                <span class="number">27</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">27</span>, <span class="string">&quot;Horror&quot;</span>)</span><br><span class="line">                <span class="number">10402</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">10402</span>, <span class="string">&quot;Music&quot;</span>)</span><br><span class="line">                <span class="number">10749</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">10749</span>, <span class="string">&quot;Romance&quot;</span>)</span><br><span class="line">                <span class="number">9648</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">9648</span>, <span class="string">&quot;Mystery&quot;</span>)</span><br><span class="line">                <span class="number">878</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">878</span>, <span class="string">&quot;Science Fiction&quot;</span>)</span><br><span class="line">                <span class="number">10770</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">10770</span>, <span class="string">&quot;TV Movie&quot;</span>)</span><br><span class="line">                <span class="number">53</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">53</span>, <span class="string">&quot;Mystery&quot;</span>)</span><br><span class="line">                <span class="number">10752</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">10752</span>, <span class="string">&quot;War&quot;</span>)</span><br><span class="line">                <span class="number">37</span> -&gt; <span class="keyword">return</span> Genre(<span class="number">37</span>, <span class="string">&quot;Western&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span> -&gt; <span class="keyword">throw</span> JsonDataException(<span class="string">&quot;unknown genre id: <span class="variable">$genreId</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">val</span> moshi: Moshi = Moshi.Builder().add(GenreAdapter()).build()</span><br><span class="line"><span class="keyword">val</span> adapter: JsonAdapter&lt;Movie&gt; = moshi.adapter(Movie::<span class="keyword">class</span>.java)</span><br><span class="line"><span class="keyword">val</span> movie = adapter.fromJson(moviesJson))</span><br></pre></td></tr></table></figure>

<p>The mapping is now handled and you can create Genres from the ids in the JSON. You could do this mapping after consuming the JSON by specifying <code>@Json(name = “genre_ids”) val genres: List&lt;Int&gt;</code>, but it’s better to use Moshi to do this when you ingest the content as you will discover any issues sooner.</p>
<h4 id="Further-Reading-on-Moshi-Codegen"><a href="#Further-Reading-on-Moshi-Codegen" class="headerlink" title="Further Reading on Moshi Codegen"></a>Further Reading on Moshi Codegen</h4><p><a target="_blank" rel="noopener" href="https://medium.com/@ZacSweers">Zac Sweers</a> <a target="_blank" rel="noopener" href="https://medium.com/@ZacSweers/exploring-moshis-kotlin-code-gen-dec09d72de5e">Exploring Moshi’s Kotlin Codegen</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@BladeCoder">Christophe Beyls</a> <a target="_blank" rel="noopener" href="https://medium.com/@BladeCoder/advanced-json-parsing-techniques-using-moshi-and-kotlin-daf56a7b963d">Advanced JSON parsing techniques using Moshi and Kotlin</a></p>
<h3 id="Wrapping-Up"><a href="#Wrapping-Up" class="headerlink" title="Wrapping Up"></a>Wrapping Up</h3><p>Gists for implementing the examples above in codegen and reflection are available here:</p>
<p><a target="_blank" rel="noopener" href="https://gist.github.com/alexforrester/e1b1c50bbddb5036fdb02d52d445cc84">Moshi Kotlin Reflection Example with Custom Adapter</a></p>
<p><a target="_blank" rel="noopener" href="https://gist.github.com/alexforrester/5c96ace4227916fb456ff49a16ef025d">Moshi Kotlin Codegen Example with Custom Adapter</a></p>
<p>Sample projects showing full code of the examples with data from <a target="_blank" rel="noopener" href="https://www.themoviedb.org/">The Movie Database</a> using both moshi codegen and moshi reflection with architecture components are available in the repo below.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/alexforrester/android-moshi"><strong>alexforrester/android-moshi</strong><br><em>dog: Uses Android Architecture Components to illustrate moshi parsing of json into kotlin with different…</em>github.com</a></p>
<p>I hope this article helps you get up-to-speed with Moshi if you are considering using it for your android project. Comments are welcome. Happy parsing!</p>
<p>来源：</p>
<p><a target="_blank" rel="noopener" href="https://proandroiddev.com/getting-started-using-moshi-for-json-parsing-with-kotlin-5a460bf3935a">https://proandroiddev.com/getting-started-using-moshi-for-json-parsing-with-kotlin-5a460bf3935a</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/getting-started-using-moshi-for-json-parsing-with-kotlin.html" data-id="ckweu3ext008ba1vhf19l17sj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/kotlin/" rel="tag">kotlin</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Learning-Kotlin-let-with-run-apply-also-函数的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/kotlin-let-with-run-apply-also.html" class="article-date">
  <time datetime="2019-05-11T11:50:33.000Z" itemprop="datePublished">2019-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/Kotlin/">Kotlin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/kotlin-let-with-run-apply-also.html">Learning Kotlin：let、with、run、apply、also函数的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Kotlin-Receivers"><a href="#Kotlin-Receivers" class="headerlink" title="Kotlin Receivers"></a>Kotlin Receivers</h3><p>Before continuing with the rest, let’s first explain what a <strong>receiver</strong> is in the Kotlin language, because the functions <code>let</code>, <code>also</code>, <code>apply</code>, and <code>run</code> are <em>extension functions</em> that operate on their receiver.</p>
<p>Nowadays, in modern Object Oriented Programming terminology, our code calls a method on an instance of a class. This executes a <strong>function</strong> (method) in the context of an <strong>object</strong> (instance of a class), usually referenced by the optional keyword <code>this</code>.</p>
<p>In older Object Oriented Programming parlance (Smalltalk), the function is often referred to as the <strong>message</strong>, while the instance is referred to as the <strong>receiver</strong>. The call sends the message to the receiver.</p>
<p><strong>The receiver is the object on which a function is executed</strong> and, in Kotlin, this function can be a plain old <em>instance method</em> or it can be an <em>extension function</em>.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> arguments = ...</span><br><span class="line"><span class="keyword">val</span> result = arguments.apply &#123; ... &#125; <span class="comment">// &#x27;arguments&#x27; is the receiver</span></span><br><span class="line">result.also &#123; ... &#125;                  <span class="comment">// &#x27;result&#x27; is the receiver</span></span><br></pre></td></tr></table></figure>

<p>Now let’s dive into how we can choose the correct one.</p>
<p>Note: The code-snippets are hosted on <a target="_blank" rel="noopener" href="https://play.kotlinlang.org/">https://play.kotlinlang.org</a>, which show up as embedded and runnable code in blog posts. You may need to click <em>Show Embed</em> and then accept the data-collection policy by clicking <code>**Y**</code>.</p>
<h3 id="Use-‘apply’-for-building-or-configuring-objects"><a href="#Use-‘apply’-for-building-or-configuring-objects" class="headerlink" title="Use ‘apply’ for building or configuring objects"></a>Use ‘apply’ for building or configuring objects</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">apply</span><span class="params">(lambda: <span class="type">T</span>.() -&gt; <span class="type">Unit</span>)</span></span>: T</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> Bundle = HashMap&lt;String, Any&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Bundle.<span class="title">putString</span><span class="params">(key: <span class="type">String</span>, value: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">this</span>[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Bundle.<span class="title">putInt</span><span class="params">(key: <span class="type">String</span>, value: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">this</span>[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Style</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Notification</span></span>(</span><br><span class="line">    <span class="keyword">val</span> style: Style,</span><br><span class="line">    <span class="keyword">val</span> extras: Bundle</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">InboxStyle</span> : <span class="type">Style</span></span>()</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Builder</span></span>(context: Any, channelID: String) &#123;</span><br><span class="line">        <span class="keyword">lateinit</span> <span class="keyword">var</span> style : Style</span><br><span class="line">        <span class="keyword">lateinit</span> <span class="keyword">var</span> extras : Bundle</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">build</span><span class="params">()</span></span> : Notification = Notification(style, extras)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> EXTRA_ID = <span class="string">&quot;extra_id&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> EXTRA_MAX_ITEMS = <span class="string">&quot;extra_max_items&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> context = Any()</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> channel = <span class="string">&quot;channel&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> id = <span class="string">&quot;ID&quot;</span></span><br><span class="line">    <span class="keyword">val</span> maxSize = <span class="number">20</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> extraBundle = Bundle().apply &#123;</span><br><span class="line">        putString(EXTRA_ID, id)</span><br><span class="line">        putInt(EXTRA_MAX_ITEMS, maxSize)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> notification = Notification.Builder(context, channel).apply &#123;</span><br><span class="line">        style = Notification.InboxStyle()</span><br><span class="line">        extras = extraBundle</span><br><span class="line">    &#125;.build()</span><br><span class="line">    </span><br><span class="line">    println(notification)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Notification(style=Notification<span class="variable">$InboxStyle</span>@2ff4acd0, extras=&#123;extra_max_items=20, extra_id=ID&#125;)</span><br></pre></td></tr></table></figure>

<p>Uses ‘apply’ for building a Bundle and configuring a Notification Builder</p>
<p>The <code>apply</code> function takes a lambda-with-receiver and…</p>
<ol>
<li>Provides its receiver to the lambda’s receiver<br>Inside the lambda, the receiver can be used through the optional keyword <code>**this**</code>.</li>
<li>Calls the lambda<br>The code in the lambda <strong>configures or ‘builds’</strong> the receiver.</li>
<li>Returns its receiver<br>The returned value is the configured/built receiver.</li>
</ol>
<h3 id="Use-‘also’-for-executing-side-effects-on-objects"><a href="#Use-‘also’-for-executing-side-effects-on-objects" class="headerlink" title="Use ‘also’ for executing side-effects on objects"></a>Use ‘also’ for executing side-effects on objects</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inline fun &lt;T&gt; T.also(lambda: (T) -&gt; Unit): T</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> Bundle = HashMap&lt;String, Any&gt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Bundle.<span class="title">putString</span><span class="params">(key: <span class="type">String</span>, value: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">this</span>[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Bundle.<span class="title">putInt</span><span class="params">(key: <span class="type">String</span>, value: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">this</span>[key] = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Style</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Notification</span></span>(</span><br><span class="line">    <span class="keyword">val</span> style: Style,</span><br><span class="line">    <span class="keyword">val</span> extras: Bundle</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">InboxStyle</span> : <span class="type">Style</span></span>()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Builder</span></span>(context: Any, channelID: String) &#123;</span><br><span class="line">        <span class="keyword">lateinit</span> <span class="keyword">var</span> style : Style</span><br><span class="line">        <span class="keyword">lateinit</span> <span class="keyword">var</span> extras : Bundle</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">build</span><span class="params">()</span></span> : Notification = Notification(style, extras)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> EXTRA_ID = <span class="string">&quot;extra_id&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> EXTRA_MAX_ITEMS = <span class="string">&quot;extra_max_items&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123; example() &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">example</span><span class="params">()</span></span>: Notification &#123;</span><br><span class="line">    <span class="keyword">val</span> context = Any()</span><br><span class="line">    <span class="keyword">val</span> channel = <span class="string">&quot;channel&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> id = <span class="string">&quot;ID&quot;</span></span><br><span class="line">    <span class="keyword">val</span> maxSize = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> extraBundle = Bundle().apply &#123;</span><br><span class="line">        putString(EXTRA_ID, id)</span><br><span class="line">        putInt(EXTRA_MAX_ITEMS, maxSize)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> notification = Notification.Builder(context, channel).apply &#123;</span><br><span class="line">        style = Notification.InboxStyle()</span><br><span class="line">        extras = extraBundle</span><br><span class="line">    &#125;.build()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> notification.also &#123; </span><br><span class="line">        println(it)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Notification(style=Notification<span class="variable">$InboxStyle</span>@2ff4acd0, extras=&#123;extra_max_items=20, extra_id=ID&#125;)</span><br></pre></td></tr></table></figure>

<p>Uses ‘also’ to print the ‘notification’ object</p>
<p>The <code>also</code> function takes a lambda with one parameter and…</p>
<ol>
<li>Provides its receiver to the lambda’s parameter<br>Inside the lambda, the receiver can be used through the keyword <code>**it**</code>.</li>
<li>Calls the lambda<br>The code in the lambda executes <strong>side-effects</strong> on the receiver. Side-effects can be logging, rendering on a screen, sending its data to storage or to the network, etc.</li>
<li>Returns its receiver<br>The returned value is the receiver, but now with side-effects applied to it.</li>
</ol>
<h3 id="Use-‘run’-for-transforming-objects"><a href="#Use-‘run’-for-transforming-objects" class="headerlink" title="Use ‘run’ for transforming objects"></a>Use ‘run’ for transforming objects</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inline fun &lt;T, R&gt; T.run(lambda: T.() -&gt; R): R</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">val</span> map = mapOf(<span class="string">&quot;key1&quot;</span> to <span class="number">4</span>, <span class="string">&quot;key2&quot;</span> to <span class="number">20</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> logItem = map.run &#123;</span><br><span class="line">        <span class="keyword">val</span> count = size</span><br><span class="line">        <span class="keyword">val</span> keys = keys</span><br><span class="line">        <span class="keyword">val</span> values = values</span><br><span class="line">        <span class="string">&quot;Map has <span class="variable">$count</span> keys <span class="variable">$keys</span> and values <span class="variable">$values</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(logItem)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map has 2 keys [key1, key2] and values [4, 20]</span><br></pre></td></tr></table></figure>

<p>Uses ‘run’ to transform the Map into a printable String of our liking</p>
<p>The <code>run</code> function takes a lambda-with-receiver and…</p>
<ol>
<li>Provides its receiver to the lambda’s receiver<br>Inside the lambda, the receiver can be used through the optional keyword <code>**this**</code>.</li>
<li>Calls the lambda and gets the its result of the lambda<br>The code in the lambda <strong>calculates a result</strong> based on the receiver.</li>
<li>Returns the result of the lambda<br>This allows the function to transform the receiver of type <code>T</code> into a value of type <code>R</code> that was returned by the lambda.</li>
</ol>
<h3 id="Use-‘let’-for-transforming-nullable-properties"><a href="#Use-‘let’-for-transforming-nullable-properties" class="headerlink" title="Use ‘let’ for transforming nullable properties"></a>Use ‘let’ for transforming nullable properties</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inline fun &lt;T, R&gt; T.let(lambda: (T) -&gt; R): R</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mapper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> mapProperty : Map&lt;String, <span class="built_in">Int</span>&gt;? = mapOf(<span class="string">&quot;key1&quot;</span> to <span class="number">4</span>, <span class="string">&quot;key2&quot;</span> to <span class="number">20</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">toLogString</span><span class="params">()</span></span> : String &#123;</span><br><span class="line">        <span class="keyword">return</span> mapProperty?.let &#123;</span><br><span class="line">            <span class="keyword">val</span> count = it.size</span><br><span class="line">            <span class="keyword">val</span> keys = it.keys</span><br><span class="line">            <span class="keyword">val</span> values = it.values</span><br><span class="line">            <span class="string">&quot;Map has <span class="variable">$count</span> keys <span class="variable">$keys</span> and values <span class="variable">$values</span>&quot;</span></span><br><span class="line">        &#125; ?: <span class="string">&quot;Map is empty&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(Mapper().toLogString())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map has 2 keys [key1, key2] and values [4, 20]</span><br></pre></td></tr></table></figure>

<p>Uses ‘let’ to transform the <strong>nullable</strong> property of Mapper into a printable String of our liking</p>
<p>The <code>let</code> function takes a lambda with one parameter and…</p>
<ol>
<li>Provides its receiver to the lambda’s parameter<br>Inside the lambda, the receiver can be used through the keyword <code>**it**</code>.</li>
<li>Calls the lambda and gets its result<br>The code in the lambda <strong>calculates a result</strong> based on the receiver.</li>
<li>Returns the result of the lambda<br>This allows the function to transform the receiver of type <code>T</code> into a value of type <code>R</code> that was returned by the lambda.</li>
</ol>
<p>As we can see, there is no big difference between the usage of <code>run</code> or <code>let</code>.</p>
<p>We should prefer to use <code>let</code> when</p>
<ul>
<li>The receiver is a <strong>nullable</strong> <em>property of a class</em>.<br>In multi-threaded environments, a nullable property could be set to null just <em>after</em> a null-check but just <em>before</em> actually using it. This means that Kotlin can<em>not</em> guarantee null-safety even after <code>if (myNullableProperty == null) &#123; ... &#125;</code> is true. In this case, use <code>myNullableProperty**?.let** &#123; ... &#125;</code>, because the <code>it</code> inside the lambda will never be <code>null</code>.</li>
<li>The receiver <code>this</code> inside the lambda of <code>run</code> may get confused with another <code>this</code> from an outer-scope or outer-class. In other words, if our code in the lambda would become unclear or too muddled, we may want to use <code>let</code>.</li>
</ul>
<h3 id="Use-‘with’-to-avoid-writing-the-same-receiver-over-and-over-again"><a href="#Use-‘with’-to-avoid-writing-the-same-receiver-over-and-over-again" class="headerlink" title="Use ‘with’ to avoid writing the same receiver over and over again"></a>Use ‘with’ to avoid writing the same receiver over and over again</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inline fun &lt;T, R&gt; with(receiver: T, block: T.() -&gt; R): R</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteReceiver</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">remoteControl</span><span class="params">(id: <span class="type">String</span>)</span></span> : RemoteControl = TODO()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">turnOnAction</span><span class="params">(remoteControlId: <span class="type">String</span>)</span></span> : <span class="built_in">Unit</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> remoteControl = remoteControl(remoteControlId)</span><br><span class="line">        with(remoteControl) &#123;</span><br><span class="line">            turnOnAV()</span><br><span class="line">            selectInput(HDMI_IN_2)</span><br><span class="line">            selectOutput(HDMI_OUT_1)</span><br><span class="line">            selectDSP(PASSTHROUGH)</span><br><span class="line">            setVolume(-<span class="number">20.0</span>)                   </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>Use ‘with’ to avoid writing ‘remoteControl.’ over and over again</p>
<p>The <code>with</code> function is like the <code>run</code> function but it doesn’t have a receiver. Instead, it takes a ‘receiver’ as its first parameter and the lambda-with-receiver as its second parameter. The function…</p>
<ol>
<li>Provides its first parameter to the lambda’s receiver<br>Inside the lambda, the receiver can be used through the optional keyword <code>**this**</code>.</li>
<li>Calls the lambda and get its result<br>We no longer need to <strong>write the same receiver over and over again</strong>because the receiver is represented by the <em>optional</em> keyword <code>this</code>.</li>
<li>Returns the result of the lambda<br>Although the receiver of type <code>T</code> is transformed into a value of type <code>R</code> , the <strong>return value</strong> of a <code>with</code> function <strong>is usually ignored</strong>.</li>
</ol>
<h3 id="Use-‘run’-or-‘with’-for-calling-a-function-with-multiple-receivers"><a href="#Use-‘run’-or-‘with’-for-calling-a-function-with-multiple-receivers" class="headerlink" title="Use ‘run’ or ‘with’ for calling a function with multiple receivers"></a>Use ‘run’ or ‘with’ for calling a function with multiple receivers</h3><p>Earlier we discussed the concept of a <em>receiver</em> in Kotlin. An object not only can have one receiver, an object can have <strong>two receivers</strong>. For a function with two receivers, one receiver is the object for which this instance function is implemented, the other receiver is extended by the function.</p>
<p>Here’s an example where <code>adjustVolume</code> is a function with multiple (two) receivers:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">AudioSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> volume : <span class="built_in">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AVReceiver</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> baseVolume: <span class="built_in">Double</span>) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> AudioSource.<span class="title">adjustVolume</span><span class="params">()</span></span> : <span class="built_in">Double</span> = </span><br><span class="line">        <span class="keyword">this</span><span class="symbol">@AVReceiver</span>.baseVolume + <span class="keyword">this</span><span class="symbol">@adjustVolume</span>.volume</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> audioSource = <span class="keyword">object</span>: AudioSource &#123; <span class="comment">// Is extended by &#x27;adjustVolume&#x27;</span></span><br><span class="line">        <span class="keyword">override</span> <span class="keyword">val</span> volume = <span class="number">20.0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> avReceiver = AVReceiver(-<span class="number">4.0</span>) <span class="comment">// The context in which &#x27;adjustVolume&#x27; will be called</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> outputVolume1 : <span class="built_in">Double</span> </span><br><span class="line">    <span class="keyword">val</span> outputVolume2 : <span class="built_in">Double</span></span><br><span class="line">    </span><br><span class="line">    outputVolume1 = avReceiver.run &#123; audioSource.adjustVolume() &#125;</span><br><span class="line">    </span><br><span class="line">    with(avReceiver) &#123; </span><br><span class="line">        outputVolume2 = audioSource.adjustVolume() </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$outputVolume1</span> and <span class="variable">$outputVolume2</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">16.0</span> and <span class="number">16.0</span></span><br></pre></td></tr></table></figure>

<p>In the above example of <code>adjustVolume</code>, <code>this@AVReceiver</code> is the instance-receiver and <code>this@adjustVolume</code> is the extended-receiver for the<code>AudioSource</code>.</p>
<p>The instance-receiver is often called the <strong>context</strong>. In our example, the extension-function <code>adjustVolume</code> for an <code>AudioSource</code> can be called <strong>in the context of</strong> an <code>AVReceiver</code>.</p>
<p>We know how to call a function on a single receiver. Just write <code>**receiver**.myFunction(param1, param2)</code> or something similar. But how can we provide not one but <em>two</em> receivers? This is where <code>run</code> and <code>with</code> can help.</p>
<p>Using <code>run</code> or <code>with</code>, we can call a receiver’s extension-function in the <em>context</em>of another receiver. The <em>context</em> is determined by the receiver of <code>run</code>, or the first parameter of <code>with</code>.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">AudioSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> volume : <span class="built_in">Double</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AVReceiver</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> baseVolume: <span class="built_in">Double</span>) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> AudioSource.<span class="title">adjustVolume</span><span class="params">()</span></span> : <span class="built_in">Double</span> = </span><br><span class="line">        <span class="keyword">this</span><span class="symbol">@AVReceiver</span>.baseVolume + <span class="keyword">this</span><span class="symbol">@adjustVolume</span>.volume</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> audioSource = <span class="keyword">object</span>: AudioSource &#123; <span class="comment">// Is extended by &#x27;adjustVolume&#x27;</span></span><br><span class="line">        <span class="keyword">override</span> <span class="keyword">val</span> volume = <span class="number">20.0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> avReceiver = AVReceiver(-<span class="number">4.0</span>) <span class="comment">// The context in which &#x27;adjustVolume&#x27; will be called</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> outputVolume1 : <span class="built_in">Double</span> </span><br><span class="line">    <span class="keyword">val</span> outputVolume2 : <span class="built_in">Double</span></span><br><span class="line">    </span><br><span class="line">    outputVolume1 = avReceiver.run &#123; audioSource.adjustVolume() &#125;</span><br><span class="line">    </span><br><span class="line">    with(avReceiver) &#123; </span><br><span class="line">        outputVolume2 = audioSource.adjustVolume() </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$outputVolume1</span> and <span class="variable">$outputVolume2</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">16.0</span> and <span class="number">16.0</span></span><br></pre></td></tr></table></figure>

<p>The ‘adjustVolume’ is called on an AudioSource in the context of an AVReceiver</p>
<h3 id="Quick-Recap"><a href="#Quick-Recap" class="headerlink" title="Quick Recap"></a>Quick Recap</h3><p>The return values and how the receivers are referenced in the lambda</p>
<p>The function <code>apply</code> configures or builds objects</p>
<p>The function <code>also</code> executes side-effects on objects</p>
<p>The function <code>run</code> transforms its receiver into a value of another type</p>
<p>The function <code>let</code> transforms a nullable property of a class into a value of another type</p>
<p>The function <code>with</code> helps you avoid writing the same receiver over and over again</p>
<h4 id="Bonus-Points"><a href="#Bonus-Points" class="headerlink" title="- Bonus Points -"></a>- Bonus Points -</h4><p>There are few more Standard Library Kotlin functions defined besides the five we talked about just now. Here is a short list of the other ones:</p>
<p><code>inline fun **TODO**(reason: String = &quot; ... &quot;) : Nothing</code><br><em>Todo</em> throws an exception with the provided, but optional, <code>reason</code>. If we forget to implement a piece of code and don’t remove this <em>todo</em>, our app may crash.</p>
<p><code>inline fun **repeat**(times: Int, action: (Int) -&gt; Unit): Unit</code><br><em>Repeat</em> calls the provided <code>action</code> a given number of <code>times</code>. We can write less code using <code>repeat</code> instead of a <code>for</code> loop.</p>
<p><code>inline fun &lt;T&gt; T.**takeIf**(predicate: (T) -&gt; Boolean) : T?</code><br><em>TakeIf</em> returns the receiver if the <code>predicate</code> returns <strong>true</strong>, otherwise it returns <code>null</code>. It is an alternative to an <code>if (...)</code>expression.</p>
<p><code>inline fun &lt;T&gt; T.**takeUnless**(predicate: (T) -&gt; Boolean) : T?</code><br><em>TakeUnless</em> returns the receiver if the <code>predicate</code> returns <strong>false</strong>, otherwise it returns <code>null</code>. It is an alternative to an <code>if(**!**...)</code> expression.</p>
<p>If we need to code something like <code>if (long...expression.predicate())</code>, we may need to repeat the long expression again in the <em>then</em> or <em>else</em> clause. Use <em>TakeIf</em> or <em>TakeUnless</em> to avoid this repetition.</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013064109/article/details/78786646">https://blog.csdn.net/u013064109/article/details/78786646</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/the-kotlin-chronicle/lets-also-apply-a-run-with-kotlin-on-our-minds-56f12eaef5e3">https://medium.com/the-kotlin-chronicle/lets-also-apply-a-run-with-kotlin-on-our-minds-56f12eaef5e3</a></p>
<p><a target="_blank" rel="noopener" href="https://clmirror.storage.googleapis.com/codelabs/java-to-kotlin-zh/index.html#10">作用域函数：let、apply、with、run、also</a></p>
<img class="images&#x2F;Kotlin Standard Functions v1.png">



<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6856954554718617614">https://juejin.im/post/6856954554718617614</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/kotlin-let-with-run-apply-also.html" data-id="ckweu3exs0087a1vh8p28dqad" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/kotlin/" rel="tag">kotlin</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Coroutines-on-Android-part-II-Getting-started" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/coroutines-on-android-part2-getting-startted.html" class="article-date">
  <time datetime="2019-05-10T01:48:53.000Z" itemprop="datePublished">2019-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/Kotlin/">Kotlin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/coroutines-on-android-part2-getting-startted.html">Coroutines on Android (part II): Getting started</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>来源：</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/androiddevelopers/coroutines-on-android-part-ii-getting-started-3bff117176dd">https://medium.com/androiddevelopers/coroutines-on-android-part-ii-getting-started-3bff117176dd</a></p>
<h3 id="Keeping-track-of-coroutines"><a href="#Keeping-track-of-coroutines" class="headerlink" title="Keeping track of coroutines"></a>Keeping track of coroutines</h3><p>In part one, we explored the problems that coroutines are great at solving. As a recap, coroutines are a great solution to two common programming problems:</p>
<ol>
<li><strong>Long running tasks</strong> are tasks that take too long to block the main thread.</li>
<li><strong>Main-safety</strong> allows you to ensure that any suspend function can be called from the main thread.</li>
</ol>
<p>To solve these problems, coroutines build upon regular functions by adding <strong>suspend</strong> and <strong>resume</strong>. When all coroutines on a particular thread are suspended, the thread is free to do other work.</p>
<p>However, coroutines by themselves don’t help you keep track of the work that’s being done. It’s perfectly fine to have a large number of coroutines — hundreds or even thousands — and have all of them suspended at the same time. And, while coroutines are cheap, the work they perform is often expensive, like reading files or making network requests.</p>
<p>It’s quite difficult to keep track of one thousand coroutines manually using code. You <em>could</em> try to track all of them and manually ensure they complete or cancel, but code like this is tedious and error prone. If the code is not perfect, it will lose track of a coroutine, which is what I call a <em>work leak</em>.</p>
<p>A <em>work leak</em> is like a memory leak, but worse. It’s a coroutine that’s been lost. In addition to using memory, a work leak can resume itself to use CPU, disk, or even launch a network request.</p>
<blockquote>
<p>A leaked coroutine can waste memory, CPU, disk, or even launch a network request that’s not needed.</p>
</blockquote>
<p>To help avoid leaking coroutines, Kotlin introduced <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/coroutines/basics.html#structured-concurrency"><strong>structured concurrency</strong></a>. Structured concurrency is a combination of language features and best practices that, when followed, help you keep track of all work running in coroutines.</p>
<p>On Android, we can use structured concurrency to do three things:</p>
<ol>
<li><strong>Cancel work</strong> when it is no longer needed.</li>
<li><strong>Keep track</strong> of work while it’s running.</li>
<li><strong>Signal errors</strong> when a coroutine fails.</li>
</ol>
<p>Lets dive into each of these and see how structured concurrency helps us make sure we never lose track of a coroutine and leak work.</p>
<h3 id="Cancel-work-with-scopes"><a href="#Cancel-work-with-scopes" class="headerlink" title="Cancel work with scopes"></a>Cancel work with scopes</h3><p>In Kotlin, coroutines must run in something called a <code>CoroutineScope</code>. A <code>CoroutineScope</code> keeps track of your coroutines, even coroutines that are suspended. Unlike the <code>Dispatchers</code> we talked about in part one, it doesn’t actually execute your coroutines — it just makes sure you don’t lose track of them.</p>
<p>To ensure that all coroutines are tracked, Kotlin does not allow you to start a new coroutine without a <code>CoroutineScope</code>. You can think of a <code>CoroutineScope</code>as sort of like lightweight version of an <code>ExecutorService</code> with superpowers. It grants you the ability to start new coroutines which come with all that suspend and resume goodness we explored in part one.</p>
<p>A <code>CoroutineScope</code> keeps track of all your coroutines, and it can cancel all of the coroutines started in it. This fits well with Android development where you want to ensure that you clean up everything that was started by a screen when the user leaves.</p>
<blockquote>
<p>A CoroutineScope keeps track of all your coroutines, and it can cancel all of the coroutines started in it.</p>
</blockquote>
<h4 id="Starting-new-coroutines"><a href="#Starting-new-coroutines" class="headerlink" title="Starting new coroutines"></a>Starting new coroutines</h4><p>It’s important to note that you can’t just call a <code>suspend</code> function from anywhere. The suspend and resume mechanism requires that you switch from normal functions to a coroutine.</p>
<p>There are two ways to start coroutines, and they have different uses:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/launch.html"><strong>launch</strong></a> builder will start a new coroutine that is “fire and forget” — that means it won’t return the result to the caller.</li>
<li><a target="_blank" rel="noopener" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/async.html"><strong>async</strong></a> builder will start a new coroutine, and it allows you to return a result with a suspend function called <code>await</code>.</li>
</ol>
<p>In almost all cases, the right answer for how to start a coroutine from a regular function is to use <code>launch</code>. Since the regular function has no way to call <code>await</code> (remember, it can’t call suspend functions directly) it doesn’t make much sense to use <code>async</code> as your main entry to coroutines. We’ll talk later about when it makes sense to use <code>async</code>.</p>
<p>You should instead use a coroutine scope to start a coroutine by calling <code>launch</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scope.launch &#123;</span><br><span class="line">    &#x2F;&#x2F; This block starts a new coroutine </span><br><span class="line">    &#x2F;&#x2F; &quot;in&quot; the scope.</span><br><span class="line">    &#x2F;&#x2F; </span><br><span class="line">    &#x2F;&#x2F; It can call suspend functions</span><br><span class="line">   fetchDocs()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can think of <code>launch</code> as a bridge that takes your code from regular functions into a coroutines world. Inside of the <code>launch</code> body, you can call suspend functions and create main safety like we covered in the last post.</p>
<blockquote>
<p>Launch is a bridge from regular functions into coroutines.</p>
</blockquote>
<p><em>Warning:</em> A big difference between <code>launch</code> and <code>async</code> is how they handle exceptions. <code>async</code> expects that you will eventually call <code>await</code> to get a result (or exception) so it won’t throw exceptions by default. That means if you use<code>async</code> to start a new coroutine it will silently drop exceptions.</p>
<p>Since <code>launch</code> and <code>async</code> are only available on a <code>CoroutineScope</code>, you know that any coroutine you create will always be tracked by a scope. Kotlin just doesn’t let you create an untracked coroutine, which goes a long way to avoid work leaks.</p>
<h4 id="Start-in-the-ViewModel"><a href="#Start-in-the-ViewModel" class="headerlink" title="Start in the ViewModel"></a>Start in the ViewModel</h4><p>So if a <code>CoroutineScope</code> keeps track of all coroutines that are launched in it, and <code>launch</code> creates a new coroutine, where exactly should you call <code>launch</code>and put your scopes? And, when does it make sense to cancel all the coroutines started in a scope?</p>
<p>On Android, it often makes sense to associate a <code>CoroutineScope</code> with a user screen. This lets you avoid leaking coroutines or doing extra work for <code>Activities</code> or <code>Fragments</code> that are no longer relevant to the user. When the user navigates away from the screen, the <code>CoroutineScope</code> associated with the screen can <code>cancel</code> all work.</p>
<blockquote>
<p>Structured concurrency guarantees when a <strong>scope</strong> <strong>cancels</strong>, all of its <strong>coroutines</strong> <strong>cancel</strong>.</p>
</blockquote>
<p>When integrating coroutines with Android Architecture Components, you typically want to <code>launch</code> coroutines in the <code>ViewModel</code>. This is a natural place since that’s where most serious work starts — and you won’t have to worry about rotation killing all your coroutines.</p>
<p>To use coroutines in a <code>ViewModel</code>, you can use the <code>viewModelScope</code> <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/tutorials/kotlin-for-py/extension-functionsproperties.html">extension property</a> from <code>lifecycle-viewmodel-ktx:2.1.0-alpha04</code>.<code>viewModelScope</code> is on-track to be released in <a target="_blank" rel="noopener" href="https://developer.android.com/jetpack/androidx/releases/lifecycle">AndroidX Lifecycle (v2.1.0)</a> and is currently in alpha. You can read more about how it works in <a target="_blank" rel="noopener" href="http://manuelvicnt/">@manuelvicnt</a>’s <a target="_blank" rel="noopener" href="https://medium.com/androiddevelopers/easy-coroutines-in-android-viewmodelscope-25bffb605471">blog post</a>. As the library is currently in alpha, there may be bugs, and the APIs could change before the final release. If find any bugs, you can file them <a target="_blank" rel="noopener" href="https://issuetracker.google.com/issues?q=componentid:413132">here</a>.</p>
<p>Take a look at this example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class MyViewModel(): ViewModel() &#123;</span><br><span class="line">    fun userNeedsDocs() &#123;</span><br><span class="line">        &#x2F;&#x2F; Start a new coroutine in a ViewModel</span><br><span class="line">        viewModelScope.launch &#123;</span><br><span class="line">            fetchDocs()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>viewModelScope</code> will automatically cancel any coroutine that is started by this <code>ViewModel</code> when it is cleared (when the <code>onCleared()</code> callback is called). This is typically the right behavior — if we haven’t fetched the docs, and the user has closed the app, we’re probably just wasting their battery completing the request.</p>
<p>And for more safety, a <code>CoroutineScope</code> will propagate itself. So, if a coroutine you start goes on to start another coroutine, they’ll both end up in the same scope. That means even when libraries that you depend on start a coroutine from your <code>viewModelScope</code>, you’ll have a way to cancel them!</p>
<p><em>Warning:</em> Coroutines are <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/coroutines/cancellation-and-timeouts.html#cancellation-and-timeouts">cancelled cooperatively</a> by throwing a <code>CancellationException</code> when the coroutine is suspended. Exception handlers that catch a top-level exception like <code>Throwable</code> will catch this exception. If you consume the exception in an exception handler, or never suspend, the coroutine will linger in a semi-canceled state.</p>
<p>So, when you need a coroutine to run as long as a <code>ViewModel</code>, use <code>viewModelScope</code> to switch from regular functions to coroutines. Then, since <code>viewModelScope</code> will automatically <code>cancel</code> coroutines for you, it’s totally fine to write an infinite loop here without creating leaks.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fun runForever() &#123;</span><br><span class="line">    &#x2F;&#x2F; start a new coroutine in the ViewModel</span><br><span class="line">    viewModelScope.launch &#123;</span><br><span class="line">        &#x2F;&#x2F; cancelled when the ViewModel is cleared</span><br><span class="line">        while(true) &#123;</span><br><span class="line">            delay(1_000)</span><br><span class="line">            &#x2F;&#x2F; do something every second</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By using <code>viewModelScope</code> you’re able to ensure that all work, even this infinite loop, is cancelled when it is no longer needed.</p>
<h3 id="Keep-track-of-work"><a href="#Keep-track-of-work" class="headerlink" title="Keep track of work"></a>Keep track of work</h3><p>Launching one coroutine is good — and for a lot of code that’s really all you’ll ever need to do. Launch a coroutine, make a network request, and write the result to the database.</p>
<p>Sometimes, though, you need a bit more complexity. Say you wanted to do two network requests simultaneously (or at the same time) in a coroutine — to do that you’ll need to start more coroutines!</p>
<p>To make more coroutines, any suspend functions can start more coroutines by using another builder called <a target="_blank" rel="noopener" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/coroutine-scope.html">coroutineScope</a> or its cousin <a target="_blank" rel="noopener" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/supervisor-scope.html">supervisorScope</a>. This API is, honestly, a bit confusing. The <code>coroutineScope</code> builder and a <code>CoroutineScope</code> are different things despite only having one character difference in their name.</p>
<p>Launching new coroutines everywhere is one way to create potential work leaks. The caller may not know about the new coroutines, and if it doesn’t how could it keep track of the work?</p>
<p>To fix this, structured concurrency helps us out. Namely, it provides a guarantee that when a <code>suspend</code> function returns, all of its work is done.</p>
<blockquote>
<p>Structured concurrency guarantees that when a suspend function returns, all of its work is done.</p>
</blockquote>
<p>Here’s an example of using <code>coroutineScope</code> to fetch two documents:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">suspend fun fetchTwoDocs() &#123;</span><br><span class="line">    coroutineScope &#123;</span><br><span class="line">        launch &#123; fetchDoc(1) &#125;</span><br><span class="line">        async &#123; fetchDoc(2) &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, two documents are fetched from the network simultaneously. The first one is fetched in a coroutine started with <code>launch</code> which is “fire and forget” — that means it won’t return the result to the caller.</p>
<p>The second document is fetched with <code>async</code>, so the document can be returned to the caller. This example is a little weird, since typically you would use <code>async</code> for both documents — but I wanted to show that you can mix and match <code>launch</code> and <code>async</code> depending on what you need.</p>
<blockquote>
<p>coroutineScope and supervisorScope let you safely launch coroutines from suspend functions.</p>
</blockquote>
<p>Note, though, that this code never explicitly waits for either of the new coroutines! It seems like <code>fetchTwoDocs</code> will return while the coroutines are running!</p>
<p>To make structured concurrency and avoid work leaks, we want to ensure that when a suspend function like <code>fetchTwoDocs</code> returns, all of its work is done. That means both of the coroutines it launches must complete before <code>fetchTwoDocs</code> returns.</p>
<p>Kotlin ensures that the work does not leak from <code>fetchTwoDocs</code> with the <code>coroutineScope</code> builder. The <code>coroutineScope</code> builder will suspend itself until all coroutines started inside of it are complete. Because of this, there’s no way to return from <code>fetchTwoDocs</code> until all coroutines started in the <code>coroutineScope</code> builder are complete.</p>
<h4 id="Lots-and-lots-of-work"><a href="#Lots-and-lots-of-work" class="headerlink" title="Lots and lots of work"></a>Lots and lots of work</h4><p>Now that we’ve explored keeping track of one and two coroutines, it’s time to go all-in and try to keep track of one thousand coroutines!</p>
<p>Take a look at the following animation:</p>
<img src="/helloworld/images/2019051001.gif" class="">

<p>Animation showing how a coroutineScope can keep track of one thousand coroutines.</p>
<p><em>This example shows making one thousand network request simultaneously. This is not recommend in real Android code — your app will use lots of resources.</em></p>
<p>In this code, we launch one thousand coroutines with <code>launch</code> inside a <code>coroutineScope</code> builder. You can see how things get wired up. Since we’re in a <code>suspend</code> function, some code somewhere must have used a <code>CoroutineScope</code>to create a coroutine. We don’t know anything about that <code>CoroutineScope</code>, it could be a <code>viewModelScope</code> or some other <code>CoroutineScope</code> defined somewhere else. No matter what calling scope it is, the <code>coroutineScope</code>builder will use it as the parent to the new scope it creates.</p>
<p>Then, inside the <code>coroutineScope</code> block, <code>launch</code> will start coroutines “in” the new scope. As the coroutines started by launch complete, the new scope will keep track of them. Finally, once all of the coroutines started inside the <code>coroutineScope</code> are complete, <code>loadLots</code> is free to return.</p>
<p><em>Note:</em> the parent-child relationship between scopes and coroutines is created using <code>Job</code> objects. But you can often think of the relationship between coroutines and scopes without diving into that level.</p>
<blockquote>
<p>coroutineScope and supervisorScope will wait for child coroutines to complete.</p>
</blockquote>
<p>There’s a lot going on here under the hood — but what’s important is that using <code>coroutineScope</code> or <code>supervisorScope</code> you can <code>launch</code> a coroutine safely from any suspend function. Even though it will start a new coroutine, you won’t accidentally leak work because you’ll always suspend the caller until the new coroutine completes.</p>
<p>What’s really cool is <code>coroutineScope</code> will create a child scope. So if the parent scope gets cancelled, it will pass the cancellation down to all the new coroutines. If the caller was the <code>viewModelScope</code>, all one thousand coroutines would be automatically cancelled when the user navigated away from the screen. Pretty neat!</p>
<p>Before we move on to errors, it’s worth taking a moment to talk about <code>supervisorScope</code> vs. <code>coroutineScope</code>. The main difference is that a <code>coroutineScope</code> will <code>cancel</code> whenever any of its children fail. So, if one network request fails, all of the other requests are cancelled immediately. If instead you want to continue the other requests even when one fails, you can use a <code>supervisorScope</code>. A <code>supervisorScope</code> won’t cancel other children when one of them fails.</p>
<h3 id="Signal-errors-when-a-coroutine-fails"><a href="#Signal-errors-when-a-coroutine-fails" class="headerlink" title="Signal errors when a coroutine fails"></a>Signal errors when a coroutine fails</h3><p>In coroutines, errors are signaled by throwing exceptions, just like regular functions. Exceptions from a <code>suspend</code> function will be re-thrown to the caller by resume. Just like with regular functions, you’re not limited to try/catch to handle errors and you can build abstractions to perform error handling with other styles if you prefer.</p>
<p>However, there are situations where errors can get lost in coroutines.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">val unrelatedScope &#x3D; MainScope()</span><br><span class="line">&#x2F;&#x2F; example of a lost error</span><br><span class="line">suspend fun lostError() &#123;</span><br><span class="line">    &#x2F;&#x2F; async without structured concurrency</span><br><span class="line">    unrelatedScope.async &#123;</span><br><span class="line">        throw InAsyncNoOneCanHearYou(&quot;except&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note this code is declaring an unrelated coroutine scope that will launch a new coroutine without structured concurrency. Remember at the beginning I said that structured concurrency is a combination of types and programming practices, and introducing unrelated coroutine scopes in suspend functions is not following the programming practices of structured concurrency.</p>
<p>The error is lost in this code because <code>async</code> assumes that you will eventually call <code>await</code> where it will rethrow the exception. However, if you never do call <code>await</code>, the exception will be stored forever waiting patiently waiting to be raised.</p>
<blockquote>
<p>Structured concurrency guarantees that when a coroutine errors, its caller or scope is notified.</p>
</blockquote>
<p>If you do use structured concurrency for the above code, the error will correctly be thrown to the caller.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">suspend fun foundError() &#123;</span><br><span class="line">    coroutineScope &#123;</span><br><span class="line">        async &#123; </span><br><span class="line">            throw StructuredConcurrencyWill(&quot;throw&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Since the <code>coroutineScope</code> will wait for all children to complete, it can also get notified when they fail. If a coroutine started by <code>coroutineScope</code> throws an exception, <code>coroutineScope</code> can throw it to the caller. Since we’re using <code>coroutineScope</code> instead of <code>supervisorScope</code>, it would also immediately cancel all other children when the exception is thrown.</p>
<h3 id="Using-structured-concurrency"><a href="#Using-structured-concurrency" class="headerlink" title="Using structured concurrency"></a>Using structured concurrency</h3><p>In this post, I introduced structured concurrency and showed how it makes our code fit well with Android <code>ViewModel</code> to avoid work leaks.</p>
<p>I also talked about how it makes suspend functions easier to reason about. Both by ensuring they complete work before they return, as well as ensuring they signal errors by surfacing exceptions.</p>
<p>If instead we used unstructured concurrency, it would be easy for coroutines to accidentally leak work that the caller didn’t know about. The work would not be cancellable, and it would not be guaranteed that exceptions would be rethrown. This would make our code more surprising, and possibly create obscure bugs.</p>
<p>You <em>can</em> create unstructured concurrency by introducing a new unrelated <code>CoroutineScope</code> (note the capital <code>C</code>), or by using a global scope called <code>GlobalScope</code>, but you should only consider unstructured concurrency in rare cases when you need the coroutine to live longer than the calling scope. It’s a good idea to then add structure yourself to ensure you keep track of the unstructured coroutines, handle errors, and have a good cancellation story.</p>
<p>Structured concurrency does take some getting used to if you have experience with unstructured concurrency. The structure and guarantees do it make it safer and easier to interact with <code>suspend</code> functions. It’s a good idea to work with structured concurrency as much as possible, because it helps make code easier to read and much less surprising.</p>
<p>At the start of this post I listed three things that structured concurrency solves for us</p>
<ol>
<li><strong>Cancel work</strong> when it is no longer needed.</li>
<li><strong>Keep track</strong> of work while it’s running.</li>
<li><strong>Signal errors</strong> when a coroutine fails.</li>
</ol>
<p>To accomplish this structured concurrency gives us some guarantees about our code. Here are the guarantees of structured concurrency.</p>
<ol>
<li>When a <strong>scope</strong> <strong>cancels</strong>, all of its <strong>coroutines</strong> <strong>cancel</strong>.</li>
<li>When a <strong>suspend fun</strong> <strong>returns</strong>, all of its <strong>work is done</strong>.</li>
<li>When a <strong>coroutine</strong> <strong>errors</strong>, its <strong>caller or scope is notified</strong>.</li>
</ol>
<p>Put together, the guarantees of structured concurrency make our code safer, easier to reason about, and allow us to avoid leaking work!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/coroutines-on-android-part2-getting-startted.html" data-id="ckweu3exr0084a1vh6ms1aow4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/kotlin/" rel="tag">kotlin</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Coroutines-on-Android-part-I-Getting-the-background" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/coroutines-on-android-part1-getting-the-background.html" class="article-date">
  <time datetime="2019-05-10T01:48:19.000Z" itemprop="datePublished">2019-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/Kotlin/">Kotlin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/coroutines-on-android-part1-getting-the-background.html">Coroutines on Android (part I): Getting the background</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>来源：</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/androiddevelopers/coroutines-on-android-part-i-getting-the-background-3e0e54d20bb">https://medium.com/androiddevelopers/coroutines-on-android-part-i-getting-the-background-3e0e54d20bb</a></p>
<h3 id="What-problems-do-coroutines-solve"><a href="#What-problems-do-coroutines-solve" class="headerlink" title="What problems do coroutines solve?"></a>What problems do coroutines solve?</h3><p>Kotlin <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/coroutines-overview.html">coroutines</a> introduce a new style of concurrency that can be used on Android to simplify async code. While they’re new to Kotlin in 1.3, the concept of coroutines has been around since the dawn of programming languages. The first language to explore using coroutines was <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Simula">Simula</a> in 1967.</p>
<p>In the last few years, coroutines have grown in popularity and are now included in many popular programming languages such as <a target="_blank" rel="noopener" href="https://javascript.info/async-await">Javascript</a>, <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/">C#</a>, <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/asyncio-task.html">Python</a>, <a target="_blank" rel="noopener" href="https://ruby-doc.org/core-2.1.1/Fiber.html">Ruby</a>, and <a target="_blank" rel="noopener" href="https://tour.golang.org/concurrency/1">Go</a> to name a few. Kotlin coroutines are based on established concepts that have been used to build large applications.</p>
<p>On Android, coroutines are a great solution to two problems:</p>
<ol>
<li><strong>Long running tasks</strong> are tasks that take too long to block the main thread.</li>
<li><strong>Main-safety</strong> allows you to ensure that any suspend function can be called from the main thread.</li>
</ol>
<p>Let’s dive in to each to see how coroutines can help us structure code in a cleaner way!</p>
<h3 id="Long-running-tasks"><a href="#Long-running-tasks" class="headerlink" title="Long running tasks"></a>Long running tasks</h3><p>Fetching a webpage or interacting with an API both involve making a network request. Similarly, reading from a database or loading an image from disk involve reading a file. These sorts of things are what I call long running tasks — tasks that take far too long for your app to stop and wait for them!</p>
<p>It can be hard to understand how fast a modern phone executes code compared to a network request. On a Pixel 2, a single CPU cycle takes just under 0.0000004 seconds, a number that’s pretty hard to grasp in human terms. However, if you think of a network request as one blink of the eye, around 400 milliseconds (0.4 seconds), it’s easier to understand how fast the CPU operates. In one blink of an eye, or a somewhat slow network request, the CPU can execute over one million cycles!</p>
<p>On Android, every app has a main thread that is in charge of handling UI (like drawing views) and coordinating user interactions. If there is too much work happening on this thread, the app appears to hang or slow down, leading to an undesirable user experience. Any long running task should be done without blocking the main thread, so your app doesn’t display what’s called “jank,” like frozen animations, or respond slowly to touch events.</p>
<p>In order to perform a network request off the main thread, a common pattern is callbacks. Callbacks provide a handle to a library that it can use to call back into your code at some future time. With callbacks, fetching developer.android.com might look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class ViewModel: ViewModel() &#123;</span><br><span class="line">   fun fetchDocs() &#123;</span><br><span class="line">       get(&quot;developer.android.com&quot;) &#123; result -&gt;</span><br><span class="line">           show(result)</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Even though <code>get</code> is called from the main thread, it will use another thread to perform the network request. Then, once the result is available from the network, the callback will be called on the main thread. This is a great way to handle long running tasks, and libraries like <a target="_blank" rel="noopener" href="https://square.github.io/retrofit/">Retrofit</a> can help you make network requests without blocking the main thread.</p>
<h3 id="Using-coroutines-for-long-running-tasks"><a href="#Using-coroutines-for-long-running-tasks" class="headerlink" title="Using coroutines for long running tasks"></a>Using coroutines for long running tasks</h3><p>Coroutines are a way to simplify the code used to manage long running tasks like <code>fetchDocs</code>. To explore how coroutines make the code for long running tasks simpler, let’s rewrite the callback example above to use coroutines.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Dispatchers.Main</span><br><span class="line">suspend fun fetchDocs() &#123;</span><br><span class="line">    &#x2F;&#x2F; Dispatchers.IO</span><br><span class="line">    val result &#x3D; get(&quot;developer.android.com&quot;)</span><br><span class="line">    &#x2F;&#x2F; Dispatchers.Main</span><br><span class="line">    show(result)</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; look at this in the next section</span><br><span class="line">suspend fun get(url: String) &#x3D; withContext(Dispatchers.IO)&#123;&#x2F;*...*&#x2F;&#125;</span><br></pre></td></tr></table></figure>

<p>Doesn’t this code block the main thread? How does it return a result from <code>get</code> without waiting for the network request and blocking? It turns out coroutines provide a way for Kotlin to execute this code and never block the main thread.</p>
<p>Coroutines build upon regular functions by adding two new operations. In addition to <strong>invoke</strong> (or call) and <strong>return</strong>, coroutines add <strong>suspend</strong> and <strong>resume</strong>.</p>
<ul>
<li><strong>suspend</strong> — pause the execution of the current coroutine, saving all local variables</li>
<li><strong>resume</strong> — continue a suspended coroutine from the place it was paused</li>
</ul>
<p>This functionality is added by Kotlin by the suspend keyword on the function. You can only call suspend functions from other suspend functions, or by using a coroutine builder like <code>launch</code> to start a new coroutine.</p>
<blockquote>
<p>Suspend and resume work together to replace callbacks.</p>
</blockquote>
<p>In the example above, <code>get</code> will <strong>suspend</strong> the coroutine before it starts the network request. The function <code>get</code> will still be responsible for running the network request off the main thread. Then, when the network request completes, instead of calling a callback to notify the main thread, it can simply <strong>resume</strong> the coroutine it suspended.</p>
<img src="/helloworld/images/2019051002.gif" class="">

<p>Animation showing how Kotlin implements suspend and resume to replace callbacks.</p>
<p>Looking at how <code>fetchDocs</code> executes, you can see how <strong>suspend</strong> works. Whenever a coroutine is suspended, the current stack frame (the place that Kotlin uses to keep track of which function is running and its variables) is copied and saved for later. When it <strong>resumes</strong>, the stack frame is copied back from where it was saved and starts running again. In the middle of the animation — when all of the coroutines on the main thread are suspended, the main thread is free to update the screen and handle user events. Together, suspend and resume replace callbacks. Pretty neat!</p>
<blockquote>
<p>When all of the coroutines on the main thread are suspended, the main thread is free to do other work.</p>
</blockquote>
<p>Even though we wrote straightforward sequential code that looks exactly like a blocking network request, coroutines will run our code exactly how we want and avoid blocking the main thread!</p>
<p>Next, let’s take a look into how to use coroutines for main-safety and explore dispatchers.</p>
<h3 id="Main-safety-with-coroutines"><a href="#Main-safety-with-coroutines" class="headerlink" title="Main-safety with coroutines"></a>Main-safety with coroutines</h3><p>In Kotlin coroutines, well written suspend functions are always safe to call from the main thread. No matter what they do, they should always allow any thread to call them.</p>
<p>But, there’s a lot of things we do in our Android apps that are too slow to happen on the main thread. Network requests, parsing JSON, reading or writing from the database, or even just iterating over large lists. Any of these have the potential to run slowly enough to cause user visible “jank” and should run off the main thread.</p>
<p>Using <code>suspend</code> doesn’t tell Kotlin to run a function on a background thread. It’s worth saying clearly and often that coroutines will run on the main thread. In fact, it’s a really good idea to use <a target="_blank" rel="noopener" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-main-coroutine-dispatcher/immediate.html">Dispatchers.Main.immediate</a>when launching a coroutine in response to a UI event — that way, if you don’t end up doing a long running task that requires main-safety, the result can be available in the very next frame for the user.</p>
<blockquote>
<p>Coroutines will run on the main thread, and suspend does not mean background.</p>
</blockquote>
<p>To make a function that does work that’s too slow for the main thread main-safe, you can tell Kotlin coroutines to perform work on either the <code>Default</code> or <code>IO</code> dispatcher. In Kotlin, all coroutines must run in a dispatcher — even when they’re running on the main thread. Coroutines can <strong>suspend</strong> themselves, and the dispatcher is the thing that knows how to <strong>resume</strong> them.</p>
<p>To specify where the coroutines should run, Kotlin provides three <a target="_blank" rel="noopener" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-dispatcher/">Dispatchers</a>you can use for thread dispatch.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------------+</span><br><span class="line">|         Dispatchers.Main          |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| Main thread on Android, interact  |</span><br><span class="line">| with the UI and perform light     |</span><br><span class="line">| work                              |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| - Calling suspend functions       |</span><br><span class="line">| - Call UI functions               |</span><br><span class="line">| - Updating LiveData               |</span><br><span class="line">+-----------------------------------+</span><br><span class="line"></span><br><span class="line">+-----------------------------------+</span><br><span class="line">|          Dispatchers.IO           |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| Optimized for disk and network IO |</span><br><span class="line">| off the main thread               |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| - Database*                       |</span><br><span class="line">| - Reading&#x2F;writing files           |</span><br><span class="line">| - Networking**                    |</span><br><span class="line">+-----------------------------------+</span><br><span class="line"></span><br><span class="line">+-----------------------------------+</span><br><span class="line">|        Dispatchers.Default        |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| Optimized for CPU intensive work  |</span><br><span class="line">| off the main thread               |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| - Sorting a list                  |</span><br><span class="line">| - Parsing JSON                    |</span><br><span class="line">| - DiffUtils                       |</span><br><span class="line">+-----------------------------------+</span><br></pre></td></tr></table></figure>

<p>*** <a target="_blank" rel="noopener" href="https://developer.android.com/topic/libraries/architecture/room"><em>Room</em></a> <em>will provide main-safety automatically if you use</em> <a target="_blank" rel="noopener" href="https://medium.com/androiddevelopers/room-coroutines-422b786dc4c5"><em>suspend functions</em></a><em>,</em> <a target="_blank" rel="noopener" href="https://medium.com/androiddevelopers/room-rxjava-acb0cd4f3757"><em>RxJava</em></a><em>, or</em> <a target="_blank" rel="noopener" href="https://developer.android.com/topic/libraries/architecture/livedata#use_livedata_with_room"><em>LiveData</em></a><em>.</em></p>
<p>*** Networking libraries such as* <a target="_blank" rel="noopener" href="https://square.github.io/retrofit/"><em>Retrofit</em></a> <em>and</em> <a target="_blank" rel="noopener" href="https://developer.android.com/training/volley"><em>Volley</em></a> <em>manage their own threads and do not require explicit main-safety in your code when used with Kotlin coroutines.</em></p>
<p>To continue with the example above, let’s use the dispatchers to define the <code>get</code> function. Inside the body of <code>get</code> you call <code>withContext(Dispatchers.IO)</code>to create a block that will run on the <code>IO</code> dispatcher. Any code you put inside that block will <em>always</em> execute on the <code>IO</code> dispatcher. Since <code>withContext</code> is itself a suspend function, it will work using coroutines to provide main safety.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Dispatchers.Main</span><br><span class="line">suspend fun fetchDocs() &#123;</span><br><span class="line">    &#x2F;&#x2F; Dispatchers.Main</span><br><span class="line">    val result &#x3D; get(&quot;developer.android.com&quot;)</span><br><span class="line">    &#x2F;&#x2F; Dispatchers.Main</span><br><span class="line">    show(result)</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; Dispatchers.Main</span><br><span class="line">suspend fun get(url: String) &#x3D;</span><br><span class="line">    &#x2F;&#x2F; Dispatchers.IO</span><br><span class="line">    withContext(Dispatchers.IO) &#123;</span><br><span class="line">        &#x2F;&#x2F; Dispatchers.IO</span><br><span class="line">        &#x2F;* perform blocking network IO here *&#x2F;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; Dispatchers.Main</span><br></pre></td></tr></table></figure>

<p>With coroutines you can do thread dispatch with fine-grained control. Because <code>withContext</code> lets you control what thread any line of code executes on without introducing a callback to return the result, you can apply it to very small functions like reading from your database or performing a network request. So a good practice is to use <code>withContext</code> to make sure every function is safe to be called on any <code>Dispatcher</code> including <code>Main</code> — that way the caller never has to think about what thread will be needed to execute the function.</p>
<p>In this example, <code>fetchDocs</code> is executing on the main thread, but can safely call <code>get</code> which performs a network request in the background. Because coroutines support <strong>suspend</strong> and <strong>resume</strong>, the coroutine on the main thread will be resumed with the result as soon as the <code>withContext</code> block is complete.</p>
<blockquote>
<p>Well written suspend functions are always safe to call from the main thread (or main-safe).</p>
</blockquote>
<p>It’s a really good idea to make every suspend function main-safe. If it does anything that touches the disk, network, or even just uses too much CPU, use <code>withContext</code> to make it safe to call from the main thread. This is the pattern that coroutines based libraries like Retrofit and Room follow. If you follow this style throughout your codebase your code will be much simpler and avoid mixing threading concerns with application logic. When followed consistently, coroutines are free to launch on the main thread and make network or database requests with simple code while guaranteeing users won’t see “jank.”</p>
<h3 id="Performance-of-withContext"><a href="#Performance-of-withContext" class="headerlink" title="Performance of withContext"></a>Performance of withContext</h3><p><code>withContext</code> is as fast as callbacks or RxJava for providing main safety. It’s even possible to optimize <code>withContext</code> calls beyond what’s possible with callbacks in some situations. If a function will make 10 calls to a database, you can tell Kotlin to switch once in an outer <code>withContext</code> around all 10 calls. Then, even though the database library will call <code>withContext</code> repeatedly, it will stay on the same dispatcher and follow a fast-path. In addition, switching between <code>Dispatchers.Default</code> and <code>Dispatchers.IO</code> is optimized to avoid thread switches whenever possible.</p>
<h3 id="What’s-next"><a href="#What’s-next" class="headerlink" title="What’s next"></a>What’s next</h3><p>In this post we explored what problems coroutines are great at solving. Coroutines are a really old concept in programming languages that have become popular recently due to their ability to make code that interacts with the network simpler.</p>
<p>On Android, you can use them to solve two really common problems:</p>
<ol>
<li>Simplifying the code for long running tasks such as reading from the network, disk, or even parsing a large JSON result.</li>
<li>Performing precise main-safety to ensure that you never accidentally block the main thread without making code difficult to read and write.</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/coroutines-on-android-part1-getting-the-background.html" data-id="ckweu3exq0080a1vhet21guaz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/kotlin/" rel="tag">kotlin</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android-反编译" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/android-decompiler.html" class="article-date">
  <time datetime="2019-05-07T08:42:37.000Z" itemprop="datePublished">2019-05-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/android-decompiler.html">Android 反编译</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://bitbucket.org/iBotPeaches/apktool/downloads/">apktool</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/pxb1988/dex2jar">dex2jar</a></p>
<p><a target="_blank" rel="noopener" href="http://java-decompiler.github.io/">Java Decompiler</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/android-decompiler.html" data-id="ckweu3exo007pa1vhc8i7fll5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/android/" rel="tag">android</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-SOLID-PRINCIPLES" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/sold-principles.html" class="article-date">
  <time datetime="2019-05-07T02:26:29.000Z" itemprop="datePublished">2019-05-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/%E8%B5%84%E6%96%99/">资料</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/sold-principles.html">SOLID PRINCIPLES</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <img src="/helloworld/images/2019050701.png" class="">

<ol>
<li><strong>Single Responsibility Principle :</strong> It is defined as,A class should have one, and only one, reason to change.</li>
<li><strong>Open-Closed Principle</strong> <strong>:</strong> Software entities (classes, modules, functions, etc…) should be open for extension, but closed for modification<br>Liskov Substitution Principle. — Child classes should never break the parent class’ type definitions.</li>
<li><strong>Liskov Substitution Principle :</strong> Child classes should never break the parent class’ type definitions.</li>
<li><strong>Interface Segregation Principle :</strong> The interface-segregation principle (ISP) states that no client should be forced to depend on methods it does not use.</li>
<li><strong>Dependency Inversion Principle :</strong> High-level  modules should not depend on low-level modules. Both should depend on  abstractions.Also Abstractions should not depend upon details. Details  should depend upon abstractions.</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/sold-principles.html" data-id="ckweu3exp007ta1vh6tczhri5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/%E8%B5%84%E6%96%99/" rel="tag">资料</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android-Dependencies" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/helloworld/android-dependecies.html" class="article-date">
  <time datetime="2019-05-04T07:57:08.000Z" itemprop="datePublished">2019-05-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/helloworld/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/helloworld/android-dependecies.html">Android Dependencies</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th>功能</th>
<th>名称</th>
<th>文档/资料</th>
</tr>
</thead>
<tbody><tr>
<td>网络请求</td>
<td><a target="_blank" rel="noopener" href="https://github.com/square/retrofit">Retrofit</a></td>
<td><a target="_blank" rel="noopener" href="http://square.github.io/retrofit/">Doc</a></td>
</tr>
<tr>
<td>图片加载</td>
<td><a target="_blank" rel="noopener" href="https://github.com/bumptech/glide">Glide</a></td>
<td><a target="_blank" rel="noopener" href="https://muyangmin.github.io/glide-docs-cn/">Doc</a></td>
</tr>
<tr>
<td>依赖注入</td>
<td>Hilt</td>
<td><a target="_blank" rel="noopener" href="https://guolin.blog.csdn.net/article/details/109787732">https://guolin.blog.csdn.net/article/details/109787732</a></td>
</tr>
</tbody></table>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://hefengbao.github.io/helloworld/android-dependecies.html" data-id="ckweu3exm007ia1vh1hwafqua" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/helloworld/tags/android/" rel="tag">android</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/helloworld/page/13/">&amp;laquo; Prev</a><a class="page-number" href="/helloworld/">1</a><span class="space">&hellip;</span><a class="page-number" href="/helloworld/page/12/">12</a><a class="page-number" href="/helloworld/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/helloworld/page/15/">15</a><a class="page-number" href="/helloworld/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/helloworld/page/23/">23</a><a class="extend next" rel="next" href="/helloworld/page/15/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/AI/">AI</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/API/">API</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Auth/">Auth</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Database/">Database</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Database/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Database/Oracle/">Oracle</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/DevOps/">DevOps</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/DevOps/MinIO/">MinIO</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/DevOps/Nginx/">Nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/DevOps/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/DevOps/Supervisor/">Supervisor</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/DevOps/WAMP/">WAMP</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Github/">Github</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Go/">Go</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Gradle/">Gradle</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/JavaScript/">JavaScript</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Javascript/">Javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Kotlin/">Kotlin</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Linux/Ubuntu/">Ubuntu</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/PHP/">PHP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/PHP/Laravel/">Laravel</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Vue/">Vue</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Web/">Web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Web/HTML/">HTML</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/Windows/">Windows</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E5%B7%A5%E5%85%B7/">工具</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E5%B7%A5%E5%85%B7/Composer/">Composer</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E5%B7%A5%E5%85%B7/PhpStorm/">PhpStorm</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E5%B7%A5%E5%85%B7/%E8%B5%84%E6%96%99/">资料</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">数据可视化</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E7%88%AC%E8%99%AB/">爬虫</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/">版本控制</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/Gitlab/">Gitlab</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/VisualSVN/">VisualSVN</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a></li><li class="category-list-item"><a class="category-list-link" href="/helloworld/categories/%E8%B5%84%E6%96%99/">资料</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/AI/" rel="tag">AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/Axios/" rel="tag">Axios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/Composer/" rel="tag">Composer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/Date/" rel="tag">Date</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/DevOps/" rel="tag">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/Go/" rel="tag">Go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/Laravel/" rel="tag">Laravel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/MinIO/" rel="tag">MinIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/OAuth-2-0/" rel="tag">OAuth 2.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/Time/" rel="tag">Time</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/TimeZone/" rel="tag">TimeZone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/VisualSVN/" rel="tag">VisualSVN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/WAMP/" rel="tag">WAMP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/Windows/" rel="tag">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/android/" rel="tag">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/android-studio/" rel="tag">android-studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/api/" rel="tag">api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/chrome/" rel="tag">chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/color/" rel="tag">color</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/composer/" rel="tag">composer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/computer/" rel="tag">computer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/crontab/" rel="tag">crontab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/cros/" rel="tag">cros</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/database/" rel="tag">database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/echarts/" rel="tag">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/elasticsearch/" rel="tag">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/emoji/" rel="tag">emoji</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/face-recognition/" rel="tag">face_recognition</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/ffmpeg/" rel="tag">ffmpeg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/gitlab/" rel="tag">gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/gradle/" rel="tag">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/homestead/" rel="tag">homestead</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/html/" rel="tag">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/https/" rel="tag">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/icon/" rel="tag">icon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/iptables/" rel="tag">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/josn-ld/" rel="tag">josn-ld</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/json/" rel="tag">json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/jwt/" rel="tag">jwt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/keyboard/" rel="tag">keyboard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/kotlin/" rel="tag">kotlin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/laravel/" rel="tag">laravel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/lemp/" rel="tag">lemp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/math/" rel="tag">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/okhttp/" rel="tag">okhttp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/opcache/" rel="tag">opcache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/oracle/" rel="tag">oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/pdf/" rel="tag">pdf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/pdo-oci/" rel="tag">pdo_oci</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/phpmyadmin/" rel="tag">phpmyadmin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/phpstorm/" rel="tag">phpstorm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/player/" rel="tag">player</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/proguard/" rel="tag">proguard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/regex/" rel="tag">regex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/room/" rel="tag">room</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/snowflake/" rel="tag">snowflake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/startup/" rel="tag">startup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/supervisor/" rel="tag">supervisor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/vue-router/" rel="tag">vue-router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/wsl/" rel="tag">wsl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/zmq/" rel="tag">zmq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E4%BA%8C%E7%BB%B4%E7%A0%81/" rel="tag">二维码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E5%A4%A7%E5%AD%A6%E8%AF%BE%E7%A8%8B/" rel="tag">大学课程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag">微服务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E6%89%93%E5%8D%B0/" rel="tag">打印</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E6%95%B0%E6%8D%AE%E9%9B%86/" rel="tag">数据集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E6%B0%B4%E5%8D%B0/" rel="tag">水印</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/" rel="tag">科学上网</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E7%BD%91%E5%AE%89/" rel="tag">网安</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E8%B5%84%E6%96%99/" rel="tag">资料</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" rel="tag">项目管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/helloworld/tags/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/" rel="tag">项目部署</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/helloworld/tags/AI/" style="font-size: 10px;">AI</a> <a href="/helloworld/tags/Axios/" style="font-size: 10px;">Axios</a> <a href="/helloworld/tags/Composer/" style="font-size: 10px;">Composer</a> <a href="/helloworld/tags/Date/" style="font-size: 10px;">Date</a> <a href="/helloworld/tags/DevOps/" style="font-size: 10px;">DevOps</a> <a href="/helloworld/tags/Go/" style="font-size: 10px;">Go</a> <a href="/helloworld/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/helloworld/tags/Laravel/" style="font-size: 10px;">Laravel</a> <a href="/helloworld/tags/MinIO/" style="font-size: 10px;">MinIO</a> <a href="/helloworld/tags/OAuth-2-0/" style="font-size: 10px;">OAuth 2.0</a> <a href="/helloworld/tags/Time/" style="font-size: 10px;">Time</a> <a href="/helloworld/tags/TimeZone/" style="font-size: 10px;">TimeZone</a> <a href="/helloworld/tags/VisualSVN/" style="font-size: 10px;">VisualSVN</a> <a href="/helloworld/tags/WAMP/" style="font-size: 12.5px;">WAMP</a> <a href="/helloworld/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/helloworld/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/helloworld/tags/android/" style="font-size: 18.75px;">android</a> <a href="/helloworld/tags/android-studio/" style="font-size: 10px;">android-studio</a> <a href="/helloworld/tags/api/" style="font-size: 10px;">api</a> <a href="/helloworld/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/helloworld/tags/color/" style="font-size: 10px;">color</a> <a href="/helloworld/tags/composer/" style="font-size: 12.5px;">composer</a> <a href="/helloworld/tags/computer/" style="font-size: 10px;">computer</a> <a href="/helloworld/tags/crontab/" style="font-size: 10px;">crontab</a> <a href="/helloworld/tags/cros/" style="font-size: 10px;">cros</a> <a href="/helloworld/tags/css/" style="font-size: 10px;">css</a> <a href="/helloworld/tags/database/" style="font-size: 10px;">database</a> <a href="/helloworld/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/helloworld/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/helloworld/tags/emoji/" style="font-size: 10px;">emoji</a> <a href="/helloworld/tags/face-recognition/" style="font-size: 10px;">face_recognition</a> <a href="/helloworld/tags/ffmpeg/" style="font-size: 10px;">ffmpeg</a> <a href="/helloworld/tags/git/" style="font-size: 12.5px;">git</a> <a href="/helloworld/tags/github/" style="font-size: 11.25px;">github</a> <a href="/helloworld/tags/gitlab/" style="font-size: 11.25px;">gitlab</a> <a href="/helloworld/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/helloworld/tags/hexo/" style="font-size: 11.25px;">hexo</a> <a href="/helloworld/tags/homestead/" style="font-size: 12.5px;">homestead</a> <a href="/helloworld/tags/html/" style="font-size: 10px;">html</a> <a href="/helloworld/tags/http/" style="font-size: 11.25px;">http</a> <a href="/helloworld/tags/https/" style="font-size: 10px;">https</a> <a href="/helloworld/tags/icon/" style="font-size: 10px;">icon</a> <a href="/helloworld/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/helloworld/tags/java/" style="font-size: 11.25px;">java</a> <a href="/helloworld/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/helloworld/tags/josn-ld/" style="font-size: 10px;">josn-ld</a> <a href="/helloworld/tags/json/" style="font-size: 11.25px;">json</a> <a href="/helloworld/tags/jwt/" style="font-size: 10px;">jwt</a> <a href="/helloworld/tags/keyboard/" style="font-size: 10px;">keyboard</a> <a href="/helloworld/tags/kotlin/" style="font-size: 20px;">kotlin</a> <a href="/helloworld/tags/laravel/" style="font-size: 17.5px;">laravel</a> <a href="/helloworld/tags/lemp/" style="font-size: 10px;">lemp</a> <a href="/helloworld/tags/linux/" style="font-size: 16.25px;">linux</a> <a href="/helloworld/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/helloworld/tags/math/" style="font-size: 10px;">math</a> <a href="/helloworld/tags/mysql/" style="font-size: 12.5px;">mysql</a> <a href="/helloworld/tags/nginx/" style="font-size: 12.5px;">nginx</a> <a href="/helloworld/tags/okhttp/" style="font-size: 11.25px;">okhttp</a> <a href="/helloworld/tags/opcache/" style="font-size: 10px;">opcache</a> <a href="/helloworld/tags/oracle/" style="font-size: 12.5px;">oracle</a> <a href="/helloworld/tags/pdf/" style="font-size: 10px;">pdf</a> <a href="/helloworld/tags/pdo-oci/" style="font-size: 10px;">pdo_oci</a> <a href="/helloworld/tags/php/" style="font-size: 15px;">php</a> <a href="/helloworld/tags/phpmyadmin/" style="font-size: 10px;">phpmyadmin</a> <a href="/helloworld/tags/phpstorm/" style="font-size: 10px;">phpstorm</a> <a href="/helloworld/tags/player/" style="font-size: 10px;">player</a> <a href="/helloworld/tags/proguard/" style="font-size: 10px;">proguard</a> <a href="/helloworld/tags/redis/" style="font-size: 11.25px;">redis</a> <a href="/helloworld/tags/regex/" style="font-size: 10px;">regex</a> <a href="/helloworld/tags/room/" style="font-size: 10px;">room</a> <a href="/helloworld/tags/snowflake/" style="font-size: 10px;">snowflake</a> <a href="/helloworld/tags/startup/" style="font-size: 10px;">startup</a> <a href="/helloworld/tags/supervisor/" style="font-size: 10px;">supervisor</a> <a href="/helloworld/tags/ubuntu/" style="font-size: 12.5px;">ubuntu</a> <a href="/helloworld/tags/vscode/" style="font-size: 11.25px;">vscode</a> <a href="/helloworld/tags/vue/" style="font-size: 11.25px;">vue</a> <a href="/helloworld/tags/vue-router/" style="font-size: 10px;">vue-router</a> <a href="/helloworld/tags/web/" style="font-size: 10px;">web</a> <a href="/helloworld/tags/wsl/" style="font-size: 12.5px;">wsl</a> <a href="/helloworld/tags/zmq/" style="font-size: 10px;">zmq</a> <a href="/helloworld/tags/%E4%BA%8C%E7%BB%B4%E7%A0%81/" style="font-size: 10px;">二维码</a> <a href="/helloworld/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/helloworld/tags/%E5%A4%A7%E5%AD%A6%E8%AF%BE%E7%A8%8B/" style="font-size: 10px;">大学课程</a> <a href="/helloworld/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 10px;">大数据</a> <a href="/helloworld/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 10px;">微服务</a> <a href="/helloworld/tags/%E6%89%93%E5%8D%B0/" style="font-size: 10px;">打印</a> <a href="/helloworld/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" style="font-size: 11.25px;">数据可视化</a> <a href="/helloworld/tags/%E6%95%B0%E6%8D%AE%E9%9B%86/" style="font-size: 10px;">数据集</a> <a href="/helloworld/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">架构</a> <a href="/helloworld/tags/%E6%B0%B4%E5%8D%B0/" style="font-size: 10px;">水印</a> <a href="/helloworld/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">爬虫</a> <a href="/helloworld/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/" style="font-size: 10px;">科学上网</a> <a href="/helloworld/tags/%E7%BD%91%E5%AE%89/" style="font-size: 10px;">网安</a> <a href="/helloworld/tags/%E8%B5%84%E6%96%99/" style="font-size: 13.75px;">资料</a> <a href="/helloworld/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" style="font-size: 10px;">项目管理</a> <a href="/helloworld/tags/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/" style="font-size: 10px;">项目部署</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2021/07/">七月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/helloworld/archives/2017/04/">四月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/helloworld/php-opcache-20211013.html">PHP Opcache</a>
          </li>
        
          <li>
            <a href="/helloworld/homestead-wsl2-20210901.html">Homestead &amp; WSL 2 - Windows 10</a>
          </li>
        
          <li>
            <a href="/helloworld/devops-resource-20210812.html">服务器管理学习资料</a>
          </li>
        
          <li>
            <a href="/helloworld/some-resource-20210810.html">程序员要了解的一些知识</a>
          </li>
        
          <li>
            <a href="/helloworld/bigdata-resource-20210809.html">大数据学习资料</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 He Fengbao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/helloworld/" class="mobile-nav-link">Home</a>
  
    <a href="/helloworld/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/helloworld/fancybox/jquery.fancybox.css">

  
<script src="/helloworld/fancybox/jquery.fancybox.pack.js"></script>




<script src="/helloworld/js/script.js"></script>




  </div>
</body>
</html>